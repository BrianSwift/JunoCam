(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 11.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       158,          7]
NotebookDataLength[     96123,       2393]
NotebookOptionsPosition[     88923,       2187]
NotebookOutlinePosition[     89282,       2203]
CellTagsIndexPosition[     89239,       2200]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{

Cell[CellGroupData[{
Cell["Juno Processing 15 - Radiation trend tracking", "Title",
 CellChangeTimes->{{3.696646893338592*^9, 3.696646901581667*^9}, {
   3.708611194826692*^9, 3.708611204633548*^9}, {3.708624450772833*^9, 
   3.708624450850671*^9}, {3.70865988727295*^9, 3.70865988734262*^9}, {
   3.709078815406592*^9, 3.709078831387362*^9}, {3.7094838718618307`*^9, 
   3.709483888981958*^9}, {3.709507128161285*^9, 3.709507128246653*^9}, {
   3.709645653857739*^9, 3.709645660990382*^9}, {3.709942109811679*^9, 
   3.709942118073284*^9}, 3.709946681696868*^9, {3.710308130789324*^9, 
   3.71030814362547*^9}, 3.710342637836211*^9, {3.710368647973055*^9, 
   3.7103687087371283`*^9}, {3.710391295122429*^9, 3.710391305214563*^9}, {
   3.7107094164020777`*^9, 3.710709417946374*^9}}],

Cell[CellGroupData[{

Cell["Functions", "Subsection",
 CellChangeTimes->{{3.708690589855336*^9, 3.708690590911737*^9}}],

Cell[BoxData[
 RowBox[{"Clear", "[", "\"\<Global`*\>\"", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{"On", "[", "Assert", "]"}]], "Input"],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"imageInfo", "[", "image_", "]"}], ":=", 
   RowBox[{"ImageMeasurements", "[", 
    RowBox[{"image", ",", 
     RowBox[{"{", 
      RowBox[{
      "\"\<Channels\>\"", ",", "\"\<ColorSpace\>\"", ",", "\"\<DataRange\>\"",
        ",", "\"\<DataType\>\"", ",", "\"\<Dimensions\>\"", ",", 
       "\"\<SampleDepth\>\"", ",", "\"\<Transparency\>\"", ",", "\"\<Min\>\"",
        ",", "\"\<Max\>\"", ",", "\"\<Mean\>\"", ",", "\"\<Median\>\"", ",", 
       "\"\<StandardDeviation\>\""}], "}"}], ",", "Association"}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{3.7086525560866623`*^9}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
   RowBox[{"decompanding", "=", 
    RowBox[{"Import", "[", 
     RowBox[{
     "\"\</Users/bswift/Pictures/Jupiter/decompanding.txt\>\"", ",", 
      "\"\<Table\>\""}], "]"}]}], ";"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.709248550464764*^9, 3.709248560515904*^9}, 
   3.709248646865521*^9, {3.709248687361239*^9, 3.709248727744875*^9}, {
   3.709251631123353*^9, 3.709251633904978*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"lut", "=", 
   RowBox[{
    RowBox[{
     RowBox[{"{", 
      RowBox[{
      "0", ",", "1", ",", "2", ",", "3", ",", "4", ",", "5", ",", "6", ",", 
       "7", ",", "8", ",", "9", ",", "10", ",", "11", ",", "12", ",", "13", 
       ",", "14", ",", "15", ",", "16", ",", "17", ",", "18", ",", "19", ",", 
       "20", ",", "21", ",", "22", ",", "23", ",", "25", ",", "27", ",", "29",
        ",", "31", ",", "33", ",", "35", ",", "37", ",", "39", ",", "41", ",",
        "43", ",", "45", ",", "47", ",", "49", ",", "51", ",", "53", ",", 
       "55", ",", "57", ",", "59", ",", "61", ",", "63", ",", "67", ",", "71",
        ",", "75", ",", "79", ",", "83", ",", "87", ",", "91", ",", "95", ",",
        "99", ",", "103", ",", "107", ",", "111", ",", "115", ",", "119", ",",
        "123", ",", "127", ",", "131", ",", "135", ",", "139", ",", "143", 
       ",", "147", ",", "151", ",", "155", ",", "159", ",", "163", ",", "167",
        ",", "171", ",", "175", ",", "179", ",", "183", ",", "187", ",", 
       "191", ",", "195", ",", "199", ",", "203", ",", "207", ",", "211", ",",
        "215", ",", "219", ",", "223", ",", "227", ",", "231", ",", "235", 
       ",", "239", ",", "243", ",", "247", ",", "255", ",", "263", ",", "271",
        ",", "279", ",", "287", ",", "295", ",", "303", ",", "311", ",", 
       "319", ",", "327", ",", "335", ",", "343", ",", "351", ",", "359", ",",
        "367", ",", "375", ",", "383", ",", "391", ",", "399", ",", "407", 
       ",", "415", ",", "423", ",", "431", ",", "439", ",", "447", ",", "455",
        ",", "463", ",", "471", ",", "479", ",", "487", ",", "495", ",", 
       "503", ",", "511", ",", "519", ",", "527", ",", "535", ",", "543", ",",
        "551", ",", "559", ",", "567", ",", "575", ",", "583", ",", "591", 
       ",", "599", ",", "607", ",", "615", ",", "623", ",", "631", ",", "639",
        ",", "647", ",", "655", ",", "663", ",", "671", ",", "679", ",", 
       "687", ",", "695", ",", "703", ",", "711", ",", "719", ",", "727", ",",
        "735", ",", "743", ",", "751", ",", "759", ",", "767", ",", "775", 
       ",", "783", ",", "791", ",", "799", ",", "807", ",", "815", ",", "823",
        ",", "831", ",", "839", ",", "847", ",", "855", ",", "863", ",", 
       "871", ",", "879", ",", "887", ",", "895", ",", "903", ",", "911", ",",
        "919", ",", "927", ",", "935", ",", "943", ",", "951", ",", "959", 
       ",", "967", ",", "975", ",", "983", ",", "991", ",", "999", ",", 
       "1007", ",", "1023", ",", "1039", ",", "1055", ",", "1071", ",", 
       "1087", ",", "1103", ",", "1119", ",", "1135", ",", "1151", ",", 
       "1167", ",", "1183", ",", "1199", ",", "1215", ",", "1231", ",", 
       "1247", ",", "1263", ",", "1279", ",", "1295", ",", "1311", ",", 
       "1327", ",", "1343", ",", "1359", ",", "1375", ",", "1391", ",", 
       "1407", ",", "1439", ",", "1471", ",", "1503", ",", "1535", ",", 
       "1567", ",", "1599", ",", "1631", ",", "1663", ",", "1695", ",", 
       "1727", ",", "1759", ",", "1791", ",", "1823", ",", "1855", ",", 
       "1887", ",", "1919", ",", "1951", ",", "1983", ",", "2015", ",", 
       "2047", ",", "2079", ",", "2111", ",", "2143", ",", "2175", ",", 
       "2207", ",", "2239", ",", "2271", ",", "2303", ",", "2335", ",", 
       "2367", ",", "2399", ",", "2431", ",", "2463", ",", "2495", ",", 
       "2527", ",", "2559", ",", "2591", ",", "2623", ",", "2655", ",", 
       "2687", ",", "2719", ",", "2751", ",", "2783", ",", "2815", ",", 
       "2847", ",", "2879"}], "}"}], "/", "2879."}], " ", "//", " ", 
    "Developer`ToPackedArray"}]}], " ", ";"}]], "Input",
 CellChangeTimes->{
  3.709300053433729*^9, {3.709300155808486*^9, 3.7093001727576437`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"rawToLin", "=", 
   RowBox[{"Compile", "[", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"lut", ",", "_Real", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"x", ",", "_Integer", ",", "1"}], "}"}]}], "}"}], ",", 
     RowBox[{"lut", "[", 
      RowBox[{"[", 
       RowBox[{"x", "+", "1"}], "]"}], "]"}], ",", 
     RowBox[{"CompilationTarget", "\[Rule]", "\"\<C\>\""}], ",", 
     RowBox[{"RuntimeAttributes", "\[Rule]", 
      RowBox[{"{", "Listable", "}"}]}], ",", 
     RowBox[{"Parallelization", "\[Rule]", "True"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.709320374185431*^9, 3.7093203741874638`*^9}, {
  3.7093329461978683`*^9, 3.709332947949211*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"decompandImage", "[", 
    RowBox[{"img_", "?", "ImageQ"}], "]"}], ":=", 
   RowBox[{"Image", "[", 
    RowBox[{
     RowBox[{"rawToLin", "[", 
      RowBox[{"lut", ",", 
       RowBox[{"ImageData", "[", 
        RowBox[{"img", ",", "\"\<Byte\>\""}], "]"}]}], "]"}], ",", 
     "\"\<Real32\>\""}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.709320428806663*^9, 3.709320438928236*^9}, {
   3.709332684504693*^9, 3.70933268730354*^9}, 3.7093329593830547`*^9}],

Cell["\<\
Credit for decompand performance optimization to users \
\[OpenCurlyDoubleQuote]Coolwater\[CloseCurlyDoubleQuote] and \
\[OpenCurlyDoubleQuote]Henrik Schumacher\[CloseCurlyDoubleQuote] at \
https://mathematica.stackexchange.com/questions/151654\
\>", "Text",
 CellChangeTimes->{{3.710157747467719*^9, 3.710157762625786*^9}, {
   3.710157806734722*^9, 3.710157866780788*^9}, 3.710157904203561*^9, 
   3.7101579395929003`*^9}],

Cell[BoxData[
 RowBox[{"ListPlot", "[", 
  RowBox[{"rawToLin", "[", 
   RowBox[{"lut", ",", 
    RowBox[{"Array", "[", 
     RowBox[{
      RowBox[{"#", "&"}], ",", "256", ",", "0"}], "]"}]}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.7092495214059258`*^9, 3.709249546740054*^9}, {
   3.709249671043024*^9, 3.709249706150538*^9}, {3.7092513932142773`*^9, 
   3.709251397385553*^9}, 3.709252130560368*^9, 3.709332859463361*^9, {
   3.7093328904890842`*^9, 3.709332936476074*^9}, 3.709332976702002*^9, {
   3.7093330406901417`*^9, 3.709333044374097*^9}, 3.7093333719759417`*^9, {
   3.7093336191450033`*^9, 3.709333625560688*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"importRaw", "[", "imageFilename_", "]"}], ":=", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", "rawImage", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"importedImage", "=", 
      RowBox[{"Import", "[", "imageFilename", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"imageInfo", "[", "importedImage", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Assert", "[", 
      RowBox[{"1", "==", 
       RowBox[{"ImageMeasurements", "[", 
        RowBox[{"importedImage", ",", "\"\<Channels\>\""}], "]"}]}], "]"}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"\"\<decompand Timing=\>\"", ",", 
       RowBox[{"First", "[", 
        RowBox[{"AbsoluteTiming", " ", "[", " ", 
         RowBox[{
          RowBox[{"rawImage", " ", "=", " ", 
           RowBox[{"decompandImage", "[", "importedImage", "]"}]}], ";"}], 
         "]"}], "]"}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"imageInfo", "[", "rawImage", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"ImageHistogram", "[", "importedImage", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"Print", "[", 
      RowBox[{"ImageHistogram", "[", "rawImage", "]"}], "]"}], ";", 
     "\[IndentingNewLine]", "rawImage"}]}], "\[IndentingNewLine]", 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7092539828668222`*^9, 3.70925402092834*^9}, {
   3.709254110261639*^9, 3.7092541433715057`*^9}, {3.709254183777808*^9, 
   3.709254241682164*^9}, {3.709254477617518*^9, 3.7092544778494673`*^9}, {
   3.709254752426189*^9, 3.70925477457607*^9}, {3.709254808563404*^9, 
   3.7092548521593647`*^9}, {3.709254911903756*^9, 3.709254914285447*^9}, {
   3.709255037956575*^9, 3.709255072235149*^9}, {3.709255103962435*^9, 
   3.7092551541821012`*^9}, {3.709255799916709*^9, 3.709255802938702*^9}, {
   3.7092558576947517`*^9, 3.70925587246279*^9}, {3.709256388747579*^9, 
   3.709256410668153*^9}, 3.709258237874983*^9, {3.709258485112385*^9, 
   3.709258514711862*^9}, {3.7092585858699827`*^9, 3.7092586289577093`*^9}, {
   3.709258696823091*^9, 3.709258722919241*^9}, 3.7092687770123053`*^9, {
   3.709333717596002*^9, 3.7093337514729*^9}, {3.709333977689364*^9, 
   3.709333990761187*^9}, {3.709334361552021*^9, 3.70933436892107*^9}, 
   3.709334414230853*^9, {3.709334483691733*^9, 3.709334512104998*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"promptFilename", "[", "string_", "]"}], ":=", 
  RowBox[{"SystemDialogInput", "[", 
   RowBox[{"\"\<FileOpen\>\"", ",", 
    RowBox[{"{", 
     RowBox[{"\"\<None\>\"", ",", 
      RowBox[{"{", 
       RowBox[{"\"\<Image files\>\"", " ", "\[Rule]", " ", 
        RowBox[{"{", 
         RowBox[{
         "\"\<*.jpg\>\"", ",", "\"\<*.JPG\>\"", ",", "\"\<*.jpeg\>\"", ",", 
          "\"\<*.JPEG\>\"", ",", "\"\<*.tif\>\"", ",", "\"\<*.png\>\""}], 
         "}"}]}], "}"}]}], "}"}], ",", 
    RowBox[{"WindowTitle", "\[Rule]", "string"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7092554337135572`*^9, 3.7092554896193027`*^9}}],

Cell[CellGroupData[{

Cell["Junocam Filename Format from SIS at PDS", "Subsubsection",
 CellChangeTimes->{{3.710026916402083*^9, 3.7100269306720667`*^9}}],

Cell["\<\
JNCT_YYYYDDD_OOFNNNNN_VXX.ZZZ
JNC: JunoCam
T: product type (E for EDR, R for RDR, and M for map product) YYYY: year at \
the start of image acquisition
DDD: day-of-year at the start of image acquisition
OO: orbit number (or 00 for all cruise products)
F: filter combination specifier for the image (see Appendix B) NNNNN: image \
index within that mission phase
V: version
XX: version number starting with \[OpenCurlyDoubleQuote]01\
\[CloseCurlyDoubleQuote]
ZZZ: file extension (can be IMG, LBL)

Examples:
JNCE_2016346_03R00112_V02-raw.png\
\>", "Text",
 CellChangeTimes->{{3.71002695494563*^9, 3.710026975654402*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"parseJunocamFilename", "[", "pathName_String", "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "assoc", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"StringCases", "[", 
      RowBox[{"pathName", ",", 
       RowBox[{
        RowBox[{"\"\<JNCE_\>\"", "\[IndentingNewLine]", "~~", 
         RowBox[{"date", ":", 
          RowBox[{"RegularExpression", "[", "\"\<\\\\d+\>\"", "]"}]}], 
         "\[IndentingNewLine]", "~~", " ", "\"\<_\>\"", "\[IndentingNewLine]",
          "~~", 
         RowBox[{"orbit", ":", 
          RowBox[{"RegularExpression", "[", "\"\<\\\\d+\>\"", "]"}]}], 
         "\[IndentingNewLine]", "~~", "filter_", "\[IndentingNewLine]", "~~", 
         " ", 
         RowBox[{"index", ":", 
          RowBox[{"RegularExpression", "[", "\"\<\\\\d+\>\"", "]"}]}], 
         "\[IndentingNewLine]", "~~", "\"\<_V\>\"", "\[IndentingNewLine]", "~~",
          " ", 
         RowBox[{"version", ":", 
          RowBox[{"RegularExpression", "[", "\"\<\\\\d+\>\"", "]"}]}], 
         "\[IndentingNewLine]", "~~", "\"\<-\>\"", "\[IndentingNewLine]", "~~", 
         RowBox[{"type", ":", " ", "__"}], "\[IndentingNewLine]", "~~", " ", 
         "\"\<.png\>\""}], "\[IndentingNewLine]", "\[RuleDelayed]", " ", 
        RowBox[{"(*", 
         RowBox[{"{", 
          RowBox[{
          "date", ",", "orbit", ",", "filter", ",", "index", ",", "version", 
           ",", "type"}], "}"}], "*)"}], "\[IndentingNewLine]", 
        RowBox[{"(", 
         RowBox[{"assoc", "=", 
          RowBox[{"<|", 
           RowBox[{
            RowBox[{"\"\<fnDate\>\"", "\[Rule]", "date"}], ",", 
            RowBox[{"\"\<fnOrbit\>\"", "\[Rule]", "orbit"}], ",", 
            RowBox[{"\"\<fnFilter\>\"", "->", "filter"}], ",", 
            RowBox[{"\"\<fnIndex\>\"", "->", "index"}], ",", 
            RowBox[{"\"\<fnVersion\>\"", "->", "version"}], ",", 
            RowBox[{"\"\<fnType\>\"", "->", "type"}], ",", 
            RowBox[{"\"\<fnPathName\>\"", "\[Rule]", "pathName"}]}], "|>"}]}],
          ")"}]}]}], "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Append", "[", 
      RowBox[{"assoc", ",", 
       RowBox[{"\"\<fnBaseName\>\"", "\[Rule]", " ", 
        RowBox[{"FileNameTake", "[", "pathName", "]"}]}]}], "]"}]}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.710026790878352*^9, 3.710026800947856*^9}, {
   3.710026833882373*^9, 3.710026890504315*^9}, {3.7100269950786667`*^9, 
   3.7100270370545597`*^9}, {3.710027067516371*^9, 3.710027077993885*^9}, {
   3.710027516122505*^9, 3.710027558991572*^9}, {3.710027868486038*^9, 
   3.710027868644692*^9}, {3.710028842416071*^9, 3.710028844070518*^9}, {
   3.7100292758708277`*^9, 3.710029291293243*^9}, {3.7100293459983053`*^9, 
   3.7100293690601473`*^9}, {3.710029623331626*^9, 3.71002963992934*^9}, {
   3.7100296914019737`*^9, 3.710029735428135*^9}, {3.710030475938671*^9, 
   3.710030550289227*^9}, {3.710030589516293*^9, 3.710030667966834*^9}, {
   3.710030704447294*^9, 3.710030722509508*^9}, {3.7100308500644712`*^9, 
   3.710030851973524*^9}, {3.7100308850917397`*^9, 3.710030947497768*^9}, {
   3.7100309889800653`*^9, 3.710030992154426*^9}, {3.710031044081135*^9, 
   3.7100310701752234`*^9}, {3.710031264219556*^9, 3.710031322180135*^9}, 
   3.710031366891769*^9, {3.71003141255305*^9, 3.710031450952623*^9}, {
   3.710031730448536*^9, 3.71003173226196*^9}, {3.7100317688310823`*^9, 
   3.7100318355843067`*^9}, 3.710031916646799*^9, {3.710031981076508*^9, 
   3.71003198603614*^9}, {3.710032027488752*^9, 3.710032028214714*^9}, {
   3.7100367349131527`*^9, 3.710036751485598*^9}, {3.710037303552273*^9, 
   3.710037305408615*^9}, {3.710037351821697*^9, 3.710037394903968*^9}, {
   3.710037427384849*^9, 3.710037436718795*^9}, {3.7100717354307423`*^9, 
   3.710071841194436*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"partitionRaw", "[", "fileInfo_Association", "]"}], ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", "\[IndentingNewLine]", 
     RowBox[{
     "rawImage", "\[IndentingNewLine]", ",", "imageColumns", 
      "\[IndentingNewLine]", ",", "framletRows", "\[IndentingNewLine]", ",", 
      "segments", "\[IndentingNewLine]", ",", "filters"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{"(*", " ", 
     RowBox[{
      RowBox[{"if", " ", "Raw"}], ",", " ", 
      RowBox[{
      "need", " ", "to", " ", "split", " ", "in", " ", "to", " ", "1", " ", 
       "or", " ", "3", " ", "lists", " ", "of", " ", "framelets"}]}], " ", 
     "*)"}], "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"rawImage", "=", 
      RowBox[{"fileInfo", "[", 
       RowBox[{"[", "\"\<dnImage\>\"", "]"}], "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"imageColumns", "=", 
      RowBox[{
       RowBox[{"ImageDimensions", "[", "rawImage", "]"}], "[", 
       RowBox[{"[", "2", "]"}], "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"framletRows", "=", "128"}], ";", "  ", 
     RowBox[{"(*", " ", 
      RowBox[{
      "need", " ", "to", " ", "detect", " ", "when", " ", "64", " ", 
       "instead", " ", "of", " ", "128"}], " ", "*)"}], "\[IndentingNewLine]", 
     RowBox[{"filters", "=", 
      RowBox[{"{", 
       RowBox[{"fileInfo", "[", 
        RowBox[{"[", "\"\<fnFilter\>\"", "]"}], "]"}], "}"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"{", "\"\<C\>\"", "}"}], "\[Equal]", "filters"}], ",", 
       RowBox[{"filters", "=", 
        RowBox[{"{", 
         RowBox[{"\"\<B\>\"", ",", "\"\<G\>\"", ",", "\"\<R\>\""}], "}"}]}]}],
       "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"segments", "=", 
      RowBox[{"AssociationThread", "[", "\[IndentingNewLine]", 
       RowBox[{"filters", "\[IndentingNewLine]", ",", 
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"ImagePartition", "[", 
            RowBox[{"rawImage", ",", 
             RowBox[{"{", 
              RowBox[{"imageColumns", ",", "framletRows"}], "}"}]}], "]"}], 
           "[", 
           RowBox[{"[", 
            RowBox[{"i", ";;", " ", "All", ";;", " ", 
             RowBox[{"Length", "[", "filters", "]"}]}], "]"}], "]"}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", "1", ",", 
            RowBox[{"Length", "[", "filters", "]"}]}], "}"}]}], "]"}]}], 
       "\[IndentingNewLine]", "]"}]}], ";", "\[IndentingNewLine]", 
     RowBox[{"<|", 
      RowBox[{
       RowBox[{"\"\<filters\>\"", "\[Rule]", " ", "filters"}], ",", 
       RowBox[{"\"\<segments\>\"", "\[Rule]", " ", "segments"}]}], "|>"}]}]}],
    "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{{3.710072147509197*^9, 3.710072260520547*^9}, {
   3.710072337364312*^9, 3.710072364451098*^9}, {3.7100724444529133`*^9, 
   3.7100724653949537`*^9}, {3.710072939617735*^9, 3.710073055114067*^9}, {
   3.7100731574173326`*^9, 3.710073173248177*^9}, {3.710073244797855*^9, 
   3.710073297841922*^9}, {3.710073350982997*^9, 3.710073456866191*^9}, {
   3.7100735480852823`*^9, 3.7100735830138187`*^9}, {3.71007372124479*^9, 
   3.7100737506482*^9}, {3.710074060594513*^9, 3.710074104703526*^9}, {
   3.71007415645685*^9, 3.710074190380661*^9}, {3.710074220697955*^9, 
   3.7100742413195553`*^9}, {3.7100746166851254`*^9, 3.710074646237492*^9}, {
   3.7100746810844316`*^9, 3.710074721888695*^9}, {3.710074852477455*^9, 
   3.7100748602666616`*^9}, {3.710074916993189*^9, 3.7100749201445*^9}, {
   3.7100761157006187`*^9, 3.710076138893238*^9}, 3.7100761722452993`*^9, {
   3.710076295656253*^9, 3.710076370725388*^9}, {3.7100775391668243`*^9, 
   3.710077620194195*^9}, {3.7100788309298563`*^9, 3.710078957601797*^9}, {
   3.710079184664585*^9, 3.7100792053179197`*^9}, {3.710079327440727*^9, 
   3.710079335102289*^9}, {3.7100795878430243`*^9, 3.710079751170082*^9}, {
   3.710079794264593*^9, 3.710079807609439*^9}, {3.71007988125105*^9, 
   3.710079884696699*^9}, {3.710084032099258*^9, 3.710084091237164*^9}, {
   3.7100842432123404`*^9, 3.710084278167049*^9}, {3.7100868972065563`*^9, 
   3.7100869040595427`*^9}, {3.7100892867923117`*^9, 3.7100892883162622`*^9}, 
   3.710162692023491*^9}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
  "parseJunocamFilename", "[", "\"\<JNCE_2016346_03R00112_V02-raw.png\>\"", 
   "]"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{"test", " ", "fn", " ", "parsing"}], "*)"}], " ", "*)"}]], "Input",\

 CellChangeTimes->{{3.710029376137794*^9, 3.710029398221916*^9}, {
  3.710710154373798*^9, 3.710710162595147*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{"\[LeftAssociation]", 
   RowBox[{
    RowBox[{"\"\<fnDate\>\"", "\[Rule]", "\"\<2016346\>\""}], ",", 
    RowBox[{"\"\<fnOrbit\>\"", "\[Rule]", "\"\<03\>\""}], ",", 
    RowBox[{"\"\<fnFilter\>\"", "\[Rule]", "\"\<R\>\""}], ",", 
    RowBox[{"\"\<fnIndex\>\"", "\[Rule]", "\"\<00112\>\""}], ",", 
    RowBox[{"\"\<fnVersion\>\"", "\[Rule]", "\"\<02\>\""}], ",", 
    RowBox[{"\"\<fnType\>\"", "\[Rule]", "\"\<raw\>\""}], ",", 
    RowBox[{
    "\"\<fnPathName\>\"", "\[Rule]", 
     "\"\<JNCE_2016346_03R00112_V02-raw.png\>\""}], ",", 
    RowBox[{
    "\"\<fnBaseName\>\"", "\[Rule]", 
     "\"\<JNCE_2016346_03R00112_V02-raw.png\>\""}]}], "\[RightAssociation]"}],
   " ", "*)"}]], "Input",
 CellChangeTimes->{{3.710710205647768*^9, 3.7107102079915257`*^9}}],

Cell["\<\
Possibly improve OO-ness using suggestion at \
https://mathematica.stackexchange.com/questions/8690/code-readability-and-\
object-oriented-code\
\>", "Text",
 CellChangeTimes->{{3.710206756982478*^9, 3.710206773671612*^9}}],

Cell[BoxData[
 RowBox[{"loadChannels", ":=", " ", 
  RowBox[{"Module", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{
     "rawFileName", "\[IndentingNewLine]", ",", "fnParts", 
      "\[IndentingNewLine]", ",", "importedImage", "\[IndentingNewLine]", ",",
       "dnImage", "\[IndentingNewLine]", ",", "channels"}], 
     "\[IndentingNewLine]", "}"}], ",", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"junocamFileName", "=", 
      RowBox[{"promptFilename", "[", "\"\<Select Junocam file\>\"", "]"}]}], 
     ";", "\[IndentingNewLine]", 
     RowBox[{"fnParts", "=", 
      RowBox[{"parseJunocamFilename", "[", "junocamFileName", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"importedImage", "=", 
      RowBox[{"Import", "[", "junocamFileName", "]"}]}], ";", 
     "\[IndentingNewLine]", 
     RowBox[{"If", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"fnParts", "[", 
         RowBox[{"[", "\"\<fnType\>\"", "]"}], "]"}], "\[Equal]", 
        "\"\<raw\>\""}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"dnImage", "=", 
         RowBox[{"decompandImage", "[", "importedImage", "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"fnParts", "=", 
         RowBox[{"Append", "[", 
          RowBox[{"fnParts", ",", 
           RowBox[{"\"\<dnImage\>\"", "\[Rule]", "dnImage"}]}], "]"}]}], ";", 
        "\[IndentingNewLine]", 
        RowBox[{"channels", "=", 
         RowBox[{"partitionRaw", "[", "fnParts", "]"}]}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
     RowBox[{"Join", "[", 
      RowBox[{"fnParts", ",", 
       RowBox[{"<|", 
        RowBox[{"\"\<importedImage\>\"", "\[Rule]", "importedImage"}], "|>"}],
        ",", "channels"}], "]"}]}]}], "\[IndentingNewLine]", "]"}]}]], "Input",\

 CellChangeTimes->{{3.7100245858515244`*^9, 3.7100247679891357`*^9}, {
   3.710024799768368*^9, 3.710024849299996*^9}, {3.710026724791258*^9, 
   3.710026739359251*^9}, {3.710036965569965*^9, 3.7100370125966063`*^9}, {
   3.710037047003148*^9, 3.7100370911566772`*^9}, {3.7100380539187737`*^9, 
   3.710038078803562*^9}, {3.710038111658306*^9, 3.7100381390111933`*^9}, {
   3.710038301335863*^9, 3.710038366259542*^9}, {3.710038458507427*^9, 
   3.710038470356003*^9}, {3.710038517149105*^9, 3.710038522268362*^9}, {
   3.7100385524052343`*^9, 3.710038613867817*^9}, {3.710038718457499*^9, 
   3.710038843201221*^9}, {3.710038935687595*^9, 3.710038953494298*^9}, {
   3.71003914443683*^9, 3.710039147930758*^9}, {3.710039254332176*^9, 
   3.710039283228867*^9}, 3.710039441068471*^9, {3.710039598648738*^9, 
   3.7100396040965137`*^9}, {3.710040324998345*^9, 3.710040330929927*^9}, {
   3.710040491913053*^9, 3.71004050790959*^9}, 3.710040566907147*^9, {
   3.710071631773594*^9, 3.710071652633582*^9}, {3.710071922315612*^9, 
   3.7100719234576607`*^9}, {3.71007203772369*^9, 3.710072040705398*^9}, {
   3.7100720874278316`*^9, 3.7100721265075607`*^9}, 3.710072455924185*^9, {
   3.7100748278591843`*^9, 3.7100748423388157`*^9}, {3.7100777679442263`*^9, 
   3.710077791101633*^9}, {3.710078417334684*^9, 3.710078424766864*^9}, 
   3.71007847575845*^9, 3.7101612415546417`*^9, {3.7103692153951397`*^9, 
   3.71036921593773*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Reorder", " ", "color", " ", "filter", " ", "identifiers", " ", "from", 
    " ", 
    RowBox[{"native", "/", "instrumet"}], " ", "BGR", " ", "to", " ", "RGB"}],
    " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"rgbFilters", "[", "channelObj_", "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"channelObj", "[", 
     RowBox[{"[", "\"\<filters\>\"", "]"}], "]"}], " ", "/.", " ", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{"\"\<B\>\"", ",", "\"\<G\>\"", ",", "\"\<R\>\""}], "}"}], " ", 
     "\[Rule]", " ", 
     RowBox[{"{", 
      RowBox[{"\"\<R\>\"", ",", "\"\<G\>\"", ",", "\"\<B\>\""}], 
      "}"}]}]}]}]}]], "Input",
 CellChangeTimes->{{3.710161470736511*^9, 3.7101615641601963`*^9}, {
   3.710161915737162*^9, 3.71016198260646*^9}, {3.7101620307040567`*^9, 
   3.7101620487982893`*^9}, {3.7101621463624973`*^9, 3.71016214647439*^9}, {
   3.710162299903833*^9, 3.710162329831191*^9}, {3.710162385020159*^9, 
   3.7101625047771883`*^9}, 3.7101625813135347`*^9, {3.710162619566176*^9, 
   3.710162639325493*^9}, 3.7101626987503977`*^9, {3.71024340573176*^9, 
   3.7102434067699547`*^9}, {3.710243489862397*^9, 3.710243605565155*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
   "Replace", " ", "filter", " ", "identifiers", " ", "with", " ", "full", 
    " ", "names"}], " ", "*)"}], "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"rgbFilterNames", "[", "channelObj_", "]"}], ":=", " ", 
   RowBox[{
    RowBox[{"rgbFilters", "[", "channelObj", "]"}], " ", "/.", " ", 
    RowBox[{"{", 
     RowBox[{
      RowBox[{"\"\<R\>\"", "\[Rule]", " ", "\"\<Red\>\""}], ",", 
      RowBox[{"\"\<G\>\"", "\[Rule]", "\"\<Green\>\""}], ",", 
      RowBox[{"\"\<B\>\"", "\[Rule]", "\"\<Blue\>\""}], ",", 
      RowBox[{"\"\<M\>\"", "\[Rule]", "\"\<Methane\>\""}], ",", 
      RowBox[{"\"\<C\>\"", "\[Rule]", "\"\<BRG Color\>\""}]}], 
     "}"}]}]}]}]], "Input",
 CellChangeTimes->{{3.710161470736511*^9, 3.7101615641601963`*^9}, {
   3.710161915737162*^9, 3.71016198260646*^9}, {3.7101620307040567`*^9, 
   3.7101620487982893`*^9}, {3.7101621463624973`*^9, 3.71016214647439*^9}, {
   3.710162299903833*^9, 3.710162329831191*^9}, {3.710162385020159*^9, 
   3.7101625047771883`*^9}, 3.7101625813135347`*^9, {3.710162619566176*^9, 
   3.710162639325493*^9}, 3.7101626987503977`*^9, {3.71024340573176*^9, 
   3.7102434067699547`*^9}, {3.710243489862397*^9, 3.710243605565155*^9}, {
   3.710244609010282*^9, 3.710244633751389*^9}, {3.710244669712516*^9, 
   3.710244854141913*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"list", " ", 
     RowBox[{"(", 
      RowBox[{"not", " ", "Association"}], ")"}], " ", "of", " ", "segment", 
     " ", "lists", " ", "in", " ", "RGB", " ", "order", " ", "if", " ", 
     "there", " ", "are", " ", "three", " ", "channels"}], ",", " ", 
    RowBox[{
    "or", " ", "list", " ", "with", " ", "list", " ", "of", " ", "single", 
     " ", "channel", " ", "segments"}]}], " ", "*)"}], "\[IndentingNewLine]", 
  
  RowBox[{
   RowBox[{"rgb", "[", "channelObj_", "]"}], ":=", " ", 
   RowBox[{"Values", "[", 
    RowBox[{"channelObj", "[", 
     RowBox[{"[", 
      RowBox[{"\"\<segments\>\"", ",", 
       RowBox[{"rgbFilters", "[", "channelObj", "]"}]}], "]"}], "]"}], 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.710161470736511*^9, 3.7101615641601963`*^9}, {
   3.710161915737162*^9, 3.71016198260646*^9}, {3.7101620307040567`*^9, 
   3.7101620487982893`*^9}, {3.7101621463624973`*^9, 3.71016214647439*^9}, {
   3.710162299903833*^9, 3.710162329831191*^9}, {3.710162385020159*^9, 
   3.7101625047771883`*^9}, 3.7101625813135347`*^9, {3.710162619566176*^9, 
   3.710162639325493*^9}, 3.7101626987503977`*^9, 3.710243398252467*^9, {
   3.710243663957179*^9, 3.71024369352392*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"t", "=", "loadChannels"}], ";", " ", 
   RowBox[{"Print", "[", 
    RowBox[{"Length", " ", "[", 
     RowBox[{"rgb", "[", "t", "]"}], "]"}], "]"}], ";", 
   RowBox[{"ColorCombine", "[", 
    RowBox[{"ImageAssemble", " ", "/@", " ", 
     RowBox[{"rgb", "[", "t", "]"}]}], "]"}]}], "  ", 
  RowBox[{"(*", " ", "test", " ", "*)"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.710163312684827*^9, 3.710163332459283*^9}, {
  3.710163408136338*^9, 3.710163413390567*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Load Image(s)", "Subsection",
 CellChangeTimes->{{3.708611873841505*^9, 3.7086118766797657`*^9}, {
  3.7101635272424507`*^9, 3.7101635277928658`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"imageObj", "=", "loadChannels"}], ";"}]], "Input",
 CellChangeTimes->{{3.7101605137571583`*^9, 3.710160537674428*^9}}],

Cell[BoxData[
 RowBox[{"Keys", "[", "imageObj", "]"}]], "Input",
 CellChangeTimes->{{3.7102434530219584`*^9, 3.710243465919293*^9}}],

Cell[BoxData[
 RowBox[{"imageObj", "[", 
  RowBox[{"[", "\"\<fnBaseName\>\"", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710163897321097*^9, 3.7101639175999403`*^9}, {
  3.7101639689107237`*^9, 3.710163976228409*^9}}],

Cell[BoxData[
 RowBox[{"imageObj", "[", 
  RowBox[{"[", "\"\<fnPathName\>\"", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710163897321097*^9, 3.7101639175999403`*^9}, {
  3.7101639689107237`*^9, 3.710163976228409*^9}, {3.710210743375836*^9, 
  3.710210747520919*^9}}],

Cell[BoxData[
 RowBox[{"imageObj", "[", 
  RowBox[{"[", "\"\<filters\>\"", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7101640202133703`*^9, 3.7101640332823753`*^9}}],

Cell[BoxData[
 RowBox[{"rgbFilterNames", "[", "imageObj", "]"}]], "Input",
 CellChangeTimes->{{3.710244931697906*^9, 3.710244966073461*^9}}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", 
  RowBox[{"imageObj", "[", 
   RowBox[{"[", "\"\<dnImage\>\"", "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710371917763566*^9, 3.710371926874449*^9}}],

Cell[BoxData[
 RowBox[{"Options", "[", 
  RowBox[{
   RowBox[{"imageObj", "[", 
    RowBox[{"[", "\"\<dnImage\>\"", "]"}], "]"}], ",", "MetaInformation"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.710371917763566*^9, 3.710371926874449*^9}, {
  3.710389822760932*^9, 3.710389854625943*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"imageObj", "[", 
   RowBox[{"[", "\"\<dnImage\>\"", "]"}], "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7103690937772903`*^9, 3.710369130309461*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Identify Dark Segments", "Subsection",
 CellChangeTimes->{{3.7101640677526073`*^9, 3.710164107445407*^9}}],

Cell[CellGroupData[{

Cell["Segs", "Subsubsection",
 CellChangeTimes->{{3.710292347072701*^9, 3.710292347457567*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"segs", "=", 
   RowBox[{"rgb", "[", "imageObj", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.710161423057558*^9, 3.7101614356602793`*^9}, {
  3.710164122479636*^9, 3.710164156206408*^9}}],

Cell[BoxData[
 RowBox[{"Length", "[", "segs", "]"}]], "Input",
 CellChangeTimes->{{3.710164137205257*^9, 3.710164164662129*^9}, {
  3.7101641966806*^9, 3.7101642000323553`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "segs", "]"}]], "Input",
 CellChangeTimes->{{3.7101642035956583`*^9, 3.710164208460671*^9}}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", 
  RowBox[{"segs", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710343083701161*^9, 3.7103431186194563`*^9}}],

Cell[BoxData[
 RowBox[{"rgbAdjusted", "=", 
  RowBox[{"ColorCombine", "[", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ImageAdjust", "[", 
       RowBox[{
        RowBox[{"ImageAssemble", "[", "#", "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}], "&"}], ",", "segs"}],
     "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7103695207614927`*^9, 3.7103695910749702`*^9}, {
   3.710369623894318*^9, 3.710369634875814*^9}, {3.7103696669954557`*^9, 
   3.7103696894699373`*^9}, 3.710369778565093*^9, {3.710369901748959*^9, 
   3.710369919075305*^9}, {3.710370075248199*^9, 3.710370078327639*^9}, {
   3.710370219987051*^9, 3.71037022040408*^9}}],

Cell[BoxData[
 RowBox[{"ColorSeparate", "[", 
  RowBox[{"rgbAdjusted", ",", "\"\<R\>\""}], "]"}]], "Input",
 CellChangeTimes->{{3.7103700891092033`*^9, 3.710370111524654*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell[TextData[{
 "Look at TrimmedMeans  ( Means of lower/darker ",
 StyleBox["n",
  FontSlant->"Italic"],
 " \[Epsilon] {98,78,58,38,18} percentages )"
}], "Subsubsection",
 CellChangeTimes->{{3.710246776097093*^9, 3.710246931747367*^9}}],

Cell["\<\
 Slow. Possibly improve performance by manually implementing and sorting just \
once and then forming the different averages \
\>", "Text",
 CellChangeTimes->{{3.7102465609749126`*^9, 3.710246563826148*^9}, {
   3.7102470021886263`*^9, 3.7102471188013268`*^9}, 3.710369048936228*^9, 
   3.710371131923358*^9}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
   RowBox[{
    RowBox[{"Parallelize", "[", 
     RowBox[{"trimmedMeans", "=", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"TrimmedMean", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"ImageData", "[", "#", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "trim"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"trim", ",", 
             RowBox[{"{", 
              RowBox[{
               RowBox[{"1", "-", ".98"}], ",", 
               RowBox[{"1", "-", ".78"}], ",", 
               RowBox[{"1", "-", ".58"}], ",", 
               RowBox[{"1", "-", ".38"}], ",", 
               RowBox[{"1", "-", ".18"}]}], "}"}]}], "}"}]}], "]"}], "&"}], 
        "\[IndentingNewLine]", ",", "segs", ",", 
        RowBox[{"{", 
         RowBox[{"-", "1"}], "}"}]}], "]"}]}], "]"}], ";"}], 
   "\[IndentingNewLine]", "]"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.7101670892721*^9, 3.710167271829054*^9}, {
  3.710170320777153*^9, 3.7101703361112757`*^9}, {3.710171664840537*^9, 
  3.710171667074144*^9}, {3.7101726868317127`*^9, 3.710172690141263*^9}, {
  3.710246543236362*^9, 3.710246548114299*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AbsoluteTiming", "[", 
   RowBox[{"Parallelize", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"trimmedMeans", "=", 
      RowBox[{"Map", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"Table", "[", 
          RowBox[{
           RowBox[{"TrimmedMean", "[", 
            RowBox[{
             RowBox[{"Flatten", "[", 
              RowBox[{"ImageData", "[", "#", "]"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"trim", ",", "0"}], "}"}]}], "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"trim", ",", 
             RowBox[{"{", ".99", "}"}]}], "}"}]}], "]"}], "&"}], 
        "\[IndentingNewLine]", ",", "segs", ",", 
        RowBox[{"{", 
         RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
    "]"}], "]"}], "   ", 
  RowBox[{"(*", " ", 
   RowBox[{"97.3", " ", "no", " ", "parallelize"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7101670892721*^9, 3.710167271829054*^9}, {
  3.710170320777153*^9, 3.7101703361112757`*^9}, {3.710171664840537*^9, 
  3.710171667074144*^9}, {3.7101726868317127`*^9, 3.710172690141263*^9}, {
  3.710246543236362*^9, 3.710246548114299*^9}, {3.710371220193798*^9, 
  3.710371253458168*^9}, {3.710371478598247*^9, 3.7103714868276787`*^9}, {
  3.71037153591542*^9, 3.710371537657415*^9}, {3.7103717913794117`*^9, 
  3.7103717942987022`*^9}, {3.7103718509882307`*^9, 3.710371851474959*^9}, {
  3.710382395777013*^9, 3.71038241697449*^9}, {3.710382529149859*^9, 
  3.710382538236395*^9}, {3.710712293542305*^9, 3.710712306876251*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "trimmedMeans", "]"}]], "Input",
 CellChangeTimes->{{3.710167782268024*^9, 3.710167787430181*^9}, {
  3.7103719599787273`*^9, 3.710371960916258*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ListLogPlot", "[", 
     RowBox[{
      RowBox[{"Table", "[", 
       RowBox[{
        RowBox[{"trimmedMeans", "[", 
         RowBox[{"[", 
          RowBox[{"#", ",", "All", ",", "1", ",", "cl"}], "]"}], "]"}], ",", 
        RowBox[{"{", 
         RowBox[{"cl", ",", "1", ",", "1"}], "}"}]}], "]"}], ",", 
      RowBox[{"PlotLegends", "\[Rule]", 
       RowBox[{"{", 
        RowBox[{"98", ",", "78", ",", "58", ",", "38", ",", "18"}], "}"}]}], 
      ",", 
      RowBox[{"PlotLabel", "\[Rule]", " ", 
       RowBox[{
        RowBox[{"rgbFilterNames", "[", "imageObj", "]"}], "[", 
        RowBox[{"[", "#", "]"}], "]"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
      RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], " ", "&"}], " ", "/@",
    " ", 
   RowBox[{"Range", "[", 
    RowBox[{"Length", "[", "trimmedMeans", "]"}], "]"}]}], " ", "//", " ", 
  "Column"}]], "Input",
 CellChangeTimes->{{3.710168031254334*^9, 3.710168034233745*^9}, {
   3.710168168715097*^9, 3.7101681775874033`*^9}, {3.7101692773509893`*^9, 
   3.710169336969586*^9}, {3.7101693842181177`*^9, 3.710169447676502*^9}, {
   3.710169486973878*^9, 3.710169532304124*^9}, {3.710169604574938*^9, 
   3.710169655652246*^9}, {3.710169703064775*^9, 3.710169792254653*^9}, 
   3.710169858306587*^9, {3.7101699119957743`*^9, 3.710169931846773*^9}, {
   3.710169990086409*^9, 3.7101699919974337`*^9}, {3.7101701265382853`*^9, 
   3.7101701431028547`*^9}, {3.710170734679194*^9, 3.710170740350881*^9}, {
   3.7101707875814743`*^9, 3.710170787901519*^9}, {3.710171281065569*^9, 
   3.7101712916466208`*^9}, {3.710171322703285*^9, 3.710171388868058*^9}, {
   3.710171435322771*^9, 3.710171493110448*^9}, {3.710171541805933*^9, 
   3.710171599860634*^9}, {3.71017255019829*^9, 3.7101725508353033`*^9}, {
   3.7101726189841547`*^9, 3.710172619057796*^9}, {3.7101730791750317`*^9, 
   3.710173103959496*^9}, {3.710173281832067*^9, 3.710173298797532*^9}, {
   3.71017345593425*^9, 3.710173483617654*^9}, 3.7102056842319098`*^9, {
   3.71020611853769*^9, 3.710206119424663*^9}, 3.7102451122969522`*^9, {
   3.7102469924329357`*^9, 3.710246992718244*^9}, {3.71024719980503*^9, 
   3.710247201884612*^9}, {3.710371344190048*^9, 3.710371344290369*^9}, {
   3.710371566137218*^9, 3.710371566221744*^9}, {3.710382554074849*^9, 
   3.710382554162283*^9}, {3.7103826583637857`*^9, 3.710382659130891*^9}}],

Cell[BoxData[
 RowBox[{"darkMetric", "=", 
  RowBox[{"trimmedMeans", "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", "1", ",", "1"}], "]"}], "]"}]}]], "Input",\

 CellChangeTimes->{{3.710382925002769*^9, 3.710382938352344*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{"trimmedMeans", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "All", ",", "1", ",", "2"}], "]"}], "]"}], "/", 
    RowBox[{"trimmedMeans", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "All", ",", "1", ",", "4"}], "]"}], "]"}]}], "]"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.710173936632779*^9, 3.7101739710009727`*^9}, {
  3.71017400596657*^9, 3.710174032315551*^9}, {3.710174463302258*^9, 
  3.7101745774659348`*^9}, {3.710174786997327*^9, 3.710174806612877*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"ListPlot", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"trimmedMeans", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "All", ",", "1", ",", "2"}], "]"}], "]"}], "/", 
     RowBox[{"trimmedMeans", "[", 
      RowBox[{"[", 
       RowBox[{"1", ",", "All", ",", "1", ",", "4"}], "]"}], "]"}]}], ",", 
    RowBox[{"PlotRange", "\[Rule]", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"-", "10"}], ",", "20"}], "}"}], "+", 
        RowBox[{"82", "/", "2"}]}], ",", 
       RowBox[{"{", 
        RowBox[{"2", ",", "3"}], "}"}]}], "}"}]}]}], "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710173936632779*^9, 3.7101739710009727`*^9}, {
  3.71017400596657*^9, 3.710174032315551*^9}, {3.710174463302258*^9, 
  3.7101745774659348`*^9}, {3.710174786997327*^9, 3.710174806612877*^9}, {
  3.710248937980246*^9, 3.710248972328021*^9}, {3.710249026733975*^9, 
  3.710249036700306*^9}, {3.7102490728380213`*^9, 3.710249104283266*^9}, {
  3.710249299360509*^9, 3.710249323828835*^9}, {3.7102495102771893`*^9, 
  3.710249542960314*^9}, {3.71024959901966*^9, 3.710249667322784*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["\<\
Look at fraction of pixels that are non-zero as darkness metric\
\>", "Subsubsection",
 CellChangeTimes->{{3.7102472254354773`*^9, 3.710247256362671*^9}}],

Cell[BoxData[
 RowBox[{"AbsoluteTiming", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{"nonZeroFraction", "=", 
    RowBox[{"Map", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"Total", "[", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"If", "[", 
             RowBox[{
              RowBox[{"#", ">", "0"}], ",", "1", ",", "0"}], "]"}], "&"}], 
           ",", 
           RowBox[{"flatImageData", "=", 
            RowBox[{"Flatten", "[", 
             RowBox[{"ImageData", "[", "#", "]"}], "]"}]}]}], "]"}], "]"}], 
        "/", 
        RowBox[{"Length", "[", "flatImageData", "]"}]}], "&"}], 
      "\[IndentingNewLine]", ",", "segs", ",", 
      RowBox[{"{", 
       RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
  "]"}]], "Input",
 CellChangeTimes->{{3.7101670892721*^9, 3.710167271829054*^9}, {
   3.710170320777153*^9, 3.7101703361112757`*^9}, {3.710171664840537*^9, 
   3.710171667074144*^9}, {3.7101726868317127`*^9, 3.710172690141263*^9}, 
   3.710183750786427*^9, {3.710205378374387*^9, 3.710205417146338*^9}, {
   3.710205611799879*^9, 3.7102056407854*^9}, {3.7102058827622623`*^9, 
   3.710205918342198*^9}, 3.710245278552576*^9, {3.710245310333482*^9, 
   3.710245313092003*^9}, {3.710245344117056*^9, 3.710245435468158*^9}, 
   3.7103083183484373`*^9}],

Cell[BoxData[
 RowBox[{"nonZeroFraction", "=", 
  RowBox[{"trimmedMeans", "[", 
   RowBox[{"[", 
    RowBox[{"All", ",", "All", ",", "All", ",", "1"}], "]"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.710372011776585*^9, 3.710372057444618*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "nonZeroFraction", "]"}]], "Input",
 CellChangeTimes->{{3.710205656328217*^9, 3.710205661878281*^9}, 
   3.7102467093217278`*^9}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ListPlot", "[", 
     RowBox[{
      RowBox[{"nonZeroFraction", "[", 
       RowBox[{"[", 
        RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}], ",", 
      RowBox[{"PlotLegends", "\[Rule]", "\"\<nonZeroFraction\>\""}], ",", 
      RowBox[{"PlotLabel", "\[Rule]", " ", 
       RowBox[{
        RowBox[{"rgbFilterNames", "[", "imageObj", "]"}], "[", 
        RowBox[{"[", "#", "]"}], "]"}]}], ",", 
      RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
      RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], " ", "&"}], " ", "/@",
    " ", 
   RowBox[{"Range", "[", 
    RowBox[{"Length", "[", "nonZeroFraction", "]"}], "]"}]}], " ", "//", " ", 
  "Column", " "}]], "Input",
 CellChangeTimes->{{3.710168031254334*^9, 3.710168034233745*^9}, {
   3.710168168715097*^9, 3.7101681775874033`*^9}, {3.7101692773509893`*^9, 
   3.710169336969586*^9}, {3.7101693842181177`*^9, 3.710169447676502*^9}, {
   3.710169486973878*^9, 3.710169532304124*^9}, {3.710169604574938*^9, 
   3.710169655652246*^9}, {3.710169703064775*^9, 3.710169792254653*^9}, 
   3.710169858306587*^9, {3.7101699119957743`*^9, 3.710169931846773*^9}, {
   3.710169990086409*^9, 3.7101699919974337`*^9}, {3.7101701265382853`*^9, 
   3.7101701431028547`*^9}, {3.710170734679194*^9, 3.710170740350881*^9}, {
   3.7101707875814743`*^9, 3.710170787901519*^9}, {3.710171281065569*^9, 
   3.7101712916466208`*^9}, {3.710171322703285*^9, 3.710171388868058*^9}, {
   3.710171435322771*^9, 3.710171493110448*^9}, {3.710171541805933*^9, 
   3.710171599860634*^9}, {3.71017255019829*^9, 3.7101725508353033`*^9}, {
   3.7101726189841547`*^9, 3.710172619057796*^9}, {3.7101730791750317`*^9, 
   3.710173103959496*^9}, {3.710173281832067*^9, 3.710173298797532*^9}, {
   3.71017345593425*^9, 3.710173483617654*^9}, {3.710205695182959*^9, 
   3.7102057513704576`*^9}, 3.710206027762207*^9, {3.7102060729076033`*^9, 
   3.710206075433153*^9}, {3.710206111347131*^9, 3.7102061131529913`*^9}, 
   3.710245025057748*^9, {3.710245500957263*^9, 3.710245512774547*^9}, 
   3.710245729408497*^9, {3.710247308149507*^9, 3.710247309617737*^9}, 
   3.710247359429831*^9, {3.710292417301546*^9, 3.710292418004086*^9}, 
   3.7102924688976107`*^9}],

Cell[BoxData[
 RowBox[{"p3", "=", 
  RowBox[{
   RowBox[{
    RowBox[{
     RowBox[{"ListPlot", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Abs", "[", 
        RowBox[{"Differences", "[", 
         RowBox[{"nonZeroFraction", "[", 
          RowBox[{"[", 
           RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}], "]"}], "]"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{
       "PlotLegends", "\[Rule]", "\"\<\[CapitalDelta] nonZeroFraction\>\""}], 
       ",", 
       RowBox[{"PlotLabel", "\[Rule]", " ", 
        RowBox[{
         RowBox[{"rgbFilterNames", "[", "imageObj", "]"}], "[", 
         RowBox[{"[", "#", "]"}], "]"}]}], ",", 
       RowBox[{"ImageSize", "\[Rule]", "Large"}], ",", 
       RowBox[{"PlotRange", "\[Rule]", "Full"}]}], "]"}], " ", "&"}], " ", "/@",
     " ", 
    RowBox[{"Range", "[", 
     RowBox[{"Length", "[", "nonZeroFraction", "]"}], "]"}]}], " ", "//", " ",
    "Column"}]}]], "Input",
 CellChangeTimes->{{3.710168031254334*^9, 3.710168034233745*^9}, {
   3.710168168715097*^9, 3.7101681775874033`*^9}, {3.7101692773509893`*^9, 
   3.710169336969586*^9}, {3.7101693842181177`*^9, 3.710169447676502*^9}, {
   3.710169486973878*^9, 3.710169532304124*^9}, {3.710169604574938*^9, 
   3.710169655652246*^9}, {3.710169703064775*^9, 3.710169792254653*^9}, 
   3.710169858306587*^9, {3.7101699119957743`*^9, 3.710169931846773*^9}, {
   3.710169990086409*^9, 3.7101699919974337`*^9}, {3.7101701265382853`*^9, 
   3.7101701431028547`*^9}, {3.710170734679194*^9, 3.710170740350881*^9}, {
   3.7101707875814743`*^9, 3.710170787901519*^9}, {3.710171281065569*^9, 
   3.7101712916466208`*^9}, {3.710171322703285*^9, 3.710171388868058*^9}, {
   3.710171435322771*^9, 3.710171493110448*^9}, {3.710171541805933*^9, 
   3.710171599860634*^9}, {3.71017255019829*^9, 3.7101725508353033`*^9}, {
   3.7101726189841547`*^9, 3.710172619057796*^9}, {3.7101730791750317`*^9, 
   3.710173103959496*^9}, {3.710173281832067*^9, 3.710173298797532*^9}, {
   3.71017345593425*^9, 3.710173483617654*^9}, {3.710205695182959*^9, 
   3.7102057513704576`*^9}, 3.710206027762207*^9, {3.7102060729076033`*^9, 
   3.710206075433153*^9}, {3.710206111347131*^9, 3.7102061131529913`*^9}, {
   3.710206895856529*^9, 3.710206928289146*^9}, 3.7102450719653482`*^9, {
   3.71024841810256*^9, 3.710248455201632*^9}, {3.710248586277258*^9, 
   3.7102486050321627`*^9}, {3.710248787957309*^9, 3.71024878846585*^9}, 
   3.710292478401497*^9}],

Cell[BoxData[
 RowBox[{"FindPeaks", "[", 
  RowBox[{
   RowBox[{"nonZeroFraction", "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}], ",", "1", ",", 
   "0.002"}], "]"}]], "Input",
 CellChangeTimes->{{3.710247521342286*^9, 3.710247531346859*^9}, {
  3.710247564840567*^9, 3.710247575569693*^9}, {3.710247719903319*^9, 
  3.710247741955615*^9}, {3.710247795472557*^9, 3.710247828520845*^9}, {
  3.710247888624724*^9, 3.71024792814852*^9}}],

Cell["Segments 44;;45 contain the ring", "Text",
 CellChangeTimes->{{3.7102481191638203`*^9, 3.7102481365228024`*^9}}],

Cell[BoxData[
 RowBox[{"centerSegIndex", "=", 
  RowBox[{"IntegerPart", "[", 
   RowBox[{
    RowBox[{"Length", "[", 
     RowBox[{"segs", "[", 
      RowBox[{"[", "1", "]"}], "]"}], "]"}], "/", "2"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.710370425989822*^9, 3.7103704729939337`*^9}, {
  3.710370686252508*^9, 3.7103707362027273`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "segs", "]"}]], "Input",
 CellChangeTimes->{{3.7103705629448557`*^9, 3.710370569482692*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"ImageAdjust", "[", 
     RowBox[{"#", ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
      RowBox[{"{", 
       RowBox[{"0", ",", 
        RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}], "&"}], " ", "/@", " ", 
   
   RowBox[{"segs", "[", 
    RowBox[{"[", 
     RowBox[{"1", ",", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{
         RowBox[{"-", "1"}], ",", "0", ",", "1"}], "}"}], "+", 
       "centerSegIndex"}], ",", "1"}], "]"}], "]"}]}], " ", "//", " ", 
  "Column"}]], "Input",
 CellChangeTimes->{{3.710210102954994*^9, 3.71021019391085*^9}, 
   3.710210226131216*^9, {3.710210323945306*^9, 3.710210404762671*^9}, {
   3.7102104387191563`*^9, 3.710210452532016*^9}, {3.710248176307065*^9, 
   3.7102481895934267`*^9}, {3.710370541225411*^9, 3.710370579026225*^9}, {
   3.710370747769949*^9, 3.7103707668896103`*^9}}]
}, Closed]],

Cell[CellGroupData[{

Cell["\<\
Identify segments darker than the segments containing the ring\
\>", "Subsubsection",
 CellChangeTimes->{{3.710248249592228*^9, 3.7102482614300756`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"orderedNonZeroFraction", "=", 
   RowBox[{"Ordering", "[", 
    RowBox[{"nonZeroFraction", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "All", ",", "1"}], "]"}], "]"}], " ", "]"}]}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.710245845214871*^9, 3.71024587868228*^9}, {
  3.7102461691084127`*^9, 3.710246170978345*^9}, {3.71024621131847*^9, 
  3.710246214436407*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "darkMetric", "]"}]], "Input",
 CellChangeTimes->{{3.710383071812316*^9, 3.710383077223398*^9}}],

Cell[BoxData[
 RowBox[{"orderedDarkMetrics", "=", 
  RowBox[{"Map", "[", 
   RowBox[{"Ordering", ",", "darkMetric"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.710383061975894*^9, 3.710383068374764*^9}, {
   3.710383133322052*^9, 3.7103831336555*^9}, 3.710383169102498*^9, {
   3.7103832049177847`*^9, 3.710383215900581*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Position", "[", 
   RowBox[{"orderedNonZeroFraction", ",", 
    RowBox[{"44", "|", "45"}]}], "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7102461743357477`*^9, 3.710246175218185*^9}, {
  3.710246221108313*^9, 3.710246228521532*^9}, {3.710246261310166*^9, 
  3.7102462786112537`*^9}}],

Cell[BoxData[
 RowBox[{"darkSegsCount", "=", "12", " ", 
  RowBox[{"(*", " ", 
   RowBox[{"visual", " ", "inspection"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.710370843759371*^9, 3.71037085209158*^9}, {
  3.710370898613083*^9, 3.710370909762477*^9}, {3.710372594088813*^9, 
  3.710372623520195*^9}, {3.7103817602710133`*^9, 3.710381760595883*^9}, {
  3.71038299515357*^9, 3.710382999719563*^9}, {3.710712012227324*^9, 
  3.7107120122469683`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"darkestSegmentWithoutRingsIndicies", "=", 
   RowBox[{"Sort", "[", 
    RowBox[{"Take", "[", 
     RowBox[{"orderedNonZeroFraction", ",", "darkSegsCount"}], "]"}], "]"}]}],
   "*)"}]], "Input",
 CellChangeTimes->{{3.7102463447916393`*^9, 3.710246437860067*^9}, {
   3.710250268325584*^9, 3.710250297545615*^9}, {3.7102959527571087`*^9, 
   3.710295953064885*^9}, {3.710296647575614*^9, 3.710296647646707*^9}, 
   3.71037092643568*^9}],

Cell[BoxData[
 RowBox[{"darkestSegmentIndicies", "=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Sort", "[", 
      RowBox[{"Take", "[", 
       RowBox[{"#", ",", "darkSegsCount"}], "]"}], "]"}], "&"}], ",", 
    "orderedDarkMetrics"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7102463447916393`*^9, 3.710246437860067*^9}, {
   3.710250268325584*^9, 3.710250297545615*^9}, {3.7102959527571087`*^9, 
   3.710295953064885*^9}, {3.710296647575614*^9, 3.710296647646707*^9}, 
   3.71037092643568*^9, {3.710383255904546*^9, 3.71038335793797*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Create Flat", "Subsection",
 CellChangeTimes->{{3.710249904251945*^9, 3.7102499128497267`*^9}}],

Cell["\<\
Flat will be per pixel trimmed mean of segments.  Trimming set to exclude a \
few of the brightest pixels/segments to exclude stars or other outliers.\
\>", "Text",
 CellChangeTimes->{{3.710250016281967*^9, 3.710250172349066*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "segs", "]"}]], "Input",
 CellChangeTimes->{{3.710250203270474*^9, 3.710250211252742*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "darkestSegmentIndicies", "]"}]], "Input",
 CellChangeTimes->{{3.710383714667622*^9, 3.710383736024487*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"darkSegs", "=", 
    RowBox[{"segs", "[", 
     RowBox[{"[", 
      RowBox[{"1", ",", "darkestSegmentWithoutRingsIndicies", ",", "1"}], 
      "]"}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710250222100504*^9, 3.7102502531873617`*^9}, 
   3.710250306300364*^9, {3.710250361745965*^9, 3.710250379756*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"darkSegs", "=", 
   RowBox[{"MapThread", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"#1", "[", 
       RowBox[{"[", 
        RowBox[{"#2", ",", "1"}], "]"}], "]"}], "&"}], ",", 
     RowBox[{"{", 
      RowBox[{"segs", ",", "darkestSegmentIndicies"}], "}"}]}], "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.710383519485434*^9, 3.710383527841234*^9}, {
  3.7103835597226152`*^9, 3.71038356015827*^9}, {3.710383595901606*^9, 
  3.710383705609496*^9}, {3.7103837519029207`*^9, 3.710383775923399*^9}, {
  3.71038382119096*^9, 3.7103838283506117`*^9}, {3.7103839385390787`*^9, 
  3.7103839389846287`*^9}, {3.7103840296550198`*^9, 3.710384030926065*^9}, {
  3.710384181042755*^9, 3.710384181609694*^9}, {3.710384255870611*^9, 
  3.7103842648285418`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "darkSegs", "]"}]], "Input",
 CellChangeTimes->{{3.710384276728024*^9, 3.710384282753574*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"darkSegsData", "=", 
   RowBox[{"Map", "[", 
    RowBox[{"ImageData", ",", "darkSegs", ",", 
     RowBox[{"{", 
      RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.710250757922312*^9, 3.7102508043287086`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "darkSegsData", "]"}]], "Input",
 CellChangeTimes->{{3.7102508133692617`*^9, 3.710250825664215*^9}}],

Cell[BoxData[
 RowBox[{"segCountForMean", "=", 
  RowBox[{
   RowBox[{"Dimensions", "[", "darkSegsData", "]"}], "[", 
   RowBox[{"[", "2", "]"}], "]"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "should", " ", "be", " ", "same", " ", "as", " ", "darkSegsCount"}], " ", 
   "*)"}]}]], "Input",
 CellChangeTimes->{{3.710384652860029*^9, 3.71038465740206*^9}, {
  3.7103847235285*^9, 3.710384746069951*^9}, {3.710384992459536*^9, 
  3.710385007576511*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"Transpose", "[", 
   RowBox[{"darkSegsData", ",", 
    RowBox[{"{", 
     RowBox[{"1", ",", "4", ",", "2", ",", "3"}], "}"}]}], "]"}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.710251180939003*^9, 3.710251234904501*^9}, {
  3.71025129220752*^9, 3.7102512926300993`*^9}, {3.710251356910043*^9, 
  3.710251371832096*^9}, {3.710251419503981*^9, 3.7102514497728567`*^9}, {
  3.7103844436025677`*^9, 3.710384443768279*^9}, {3.710384489896299*^9, 
  3.710384535053028*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"AbsoluteTiming", "[", 
   RowBox[{
    RowBox[{"flatData", "=", 
     RowBox[{"Map", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"TrimmedMean", "[", 
         RowBox[{"#", ",", 
          RowBox[{"{", 
           RowBox[{"0", ",", 
            RowBox[{"2", "/", "segCountForMean"}]}], "}"}]}], "]"}], "&"}], 
       "\[IndentingNewLine]", ",", 
       RowBox[{"Transpose", "[", 
        RowBox[{"darkSegsData", ",", 
         RowBox[{"{", 
          RowBox[{"1", ",", "4", ",", "2", ",", "3"}], "}"}]}], "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"-", "2"}], "}"}]}], "]"}]}], ";"}], "\[IndentingNewLine]", 
   "]"}], "  ", 
  RowBox[{"(*", " ", "17.2", " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.710251504884672*^9, 3.710251716989437*^9}, {
  3.710384760319536*^9, 3.710384761534246*^9}, {3.710384803678546*^9, 
  3.710384830910878*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "flatData", "]"}]], "Input",
 CellChangeTimes->{{3.710251737890709*^9, 3.710251743755018*^9}}],

Cell[BoxData[
 RowBox[{"flatTotals", "=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Total", "[", 
      RowBox[{"Flatten", "[", "#", "]"}], "]"}], "&"}], ",", "flatData"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7107132679417887`*^9, 3.7107133317761383`*^9}, {
  3.710713371973575*^9, 3.7107133963486853`*^9}, {3.7107138507247057`*^9, 
  3.710713863307375*^9}, {3.7107198566927013`*^9, 3.710719857866379*^9}}],

Cell[BoxData[
 RowBox[{"flatImage", "=", 
  RowBox[{"Map", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Image", "[", 
      RowBox[{"#", ",", "\"\<Real32\>\""}], "]"}], "&"}], ",", "flatData"}], 
   "]"}]}]], "Input",
 CellChangeTimes->{{3.7102517671267157`*^9, 3.710251798882388*^9}, 
   3.710292632427402*^9, {3.710342881446311*^9, 3.7103428854520473`*^9}, 
   3.710342945848523*^9, 3.710342976832658*^9, {3.710385178806053*^9, 
   3.7103852194762497`*^9}}],

Cell[BoxData[
 RowBox[{"imageInfo", " ", "/@", " ", "flatImage"}]], "Input",
 CellChangeTimes->{{3.710251839056917*^9, 3.710251850413971*^9}, {
  3.7103852583700323`*^9, 3.7103852668251266`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"(", 
   RowBox[{"flatImageAdj", "=", 
    RowBox[{
     RowBox[{
      RowBox[{"ImageAdjust", "[", 
       RowBox[{"#", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}], "&"}], " ", "/@", 
     " ", "flatImage"}]}], ")"}], " ", "//", " ", "Column"}]], "Input",
 CellChangeTimes->{{3.71025187119107*^9, 3.710251884571981*^9}, {
   3.710251928703761*^9, 3.7102519289677763`*^9}, {3.710292750328486*^9, 
   3.7102927534312153`*^9}, 3.7102930676121387`*^9, {3.710385301831513*^9, 
   3.710385332247183*^9}, {3.710385374175312*^9, 3.710385378943823*^9}, {
   3.7103856054024963`*^9, 3.710385617170233*^9}}],

Cell[BoxData[
 RowBox[{"If", "[", 
  RowBox[{
   RowBox[{"!", 
    RowBox[{"AssociationQ", "[", "allFlats", "]"}]}], ",", 
   RowBox[{"allFlats", "=", 
    RowBox[{"<|", "|>"}]}]}], "]"}]], "Input",
 CellChangeTimes->{{3.7107199615143423`*^9, 3.7107200068664103`*^9}, {
  3.710720056458445*^9, 3.7107200679141417`*^9}}],

Cell[BoxData[
 RowBox[{"key", "=", 
  RowBox[{"imageObj", "[", 
   RowBox[{"[", "\"\<fnBaseName\>\"", "]"}], "]"}]}]], "Input",
 CellChangeTimes->{{3.710713866644532*^9, 3.7107139237778273`*^9}}],

Cell[BoxData[
 RowBox[{"AssociateTo", "[", 
  RowBox[{"allFlats", ",", 
   RowBox[{"key", "\[Rule]", 
    RowBox[{"<|", 
     RowBox[{
      RowBox[{"totals", "->", "flatTotals"}], ",", 
      RowBox[{"image", "\[Rule]", "flatImage"}], ",", 
      RowBox[{"adjImage", "\[Rule]", " ", "flatImageAdj"}]}], "|>"}]}]}], 
  "]"}]], "Input",
 CellChangeTimes->{{3.710719090629745*^9, 3.71071909835992*^9}, {
  3.710719598289083*^9, 3.710719600158455*^9}, {3.710719684945537*^9, 
  3.710719833477346*^9}}],

Cell["\<\
Totals from Radiation Trending images
\[OpenCurlyDoubleQuote]JNCE_2016346_03C00135_V02-raw.png\
\[CloseCurlyDoubleQuote]\[Rule]\[LeftAssociation]totals\[Rule]{23.8548,22.\
5877,21.3286}
\[CloseCurlyDoubleQuote]JNCE_2017033_04C00119_V01-raw.png\
\[CloseCurlyDoubleQuote]\[Rule]\[LeftAssociation]totals\[Rule]{20.4339,19.\
0603,18.0262}
\[OpenCurlyDoubleQuote]JNCE_2017086_05C00121_V01-raw.png\
\[CloseCurlyDoubleQuote]\[Rule]\[LeftAssociation]totals\[Rule]{21.934,20.3304,\
18.9347}
\[OpenCurlyDoubleQuote]JNCE_2017139_06C00142_V01-raw.png\
\[CloseCurlyDoubleQuote]\[Rule]\[LeftAssociation]totals\[Rule]{21.0001,20.\
1315,17.801}
\[OpenCurlyDoubleQuote]JNCE_2017192_07C00074_V01-raw.png\
\[CloseCurlyDoubleQuote]\[Rule]\[LeftAssociation]totals\[Rule]{21.2407,20.\
0926,18.3445}\
\>", "Text",
 CellChangeTimes->{
  3.710720747381297*^9, {3.7107210877318687`*^9, 3.7107210948754473`*^9}, {
   3.710721403393372*^9, 3.710721406802352*^9}, {3.7107215926244087`*^9, 
   3.710721595081318*^9}, {3.710721915631176*^9, 3.710721916024296*^9}, {
   3.710722040457843*^9, 3.710722063801003*^9}}],

Cell[BoxData["allFlats"], "Input",
 CellChangeTimes->{{3.710714240421794*^9, 3.710714242242931*^9}, {
  3.7107201023605328`*^9, 3.7107201056309357`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export visible flat", "Subsection",
 CellChangeTimes->{{3.710712598069701*^9, 3.710712612995949*^9}}],

Cell["Color image to read actual values off Blue channel.", "Text",
 CellChangeTimes->{{3.710292923835553*^9, 3.71029293895357*^9}}],

Cell[BoxData[
 RowBox[{"coloredFlats", "=", 
  RowBox[{"MapThread", "[", 
   RowBox[{
    RowBox[{
     RowBox[{"Image", "[", 
      RowBox[{
       RowBox[{"ColorCombine", "[", 
        RowBox[{"{", 
         RowBox[{"#1", ",", "#1", ",", "#2"}], "}"}], "]"}], ",", 
       "\"\<Bit16\>\""}], "]"}], "&"}], ",", 
    RowBox[{"{", 
     RowBox[{"flatImageAdj", ",", "flatImage"}], "}"}]}], "]"}]}]], "Input",
 CellChangeTimes->{{3.7102927333416758`*^9, 3.710292762806983*^9}, {
   3.710292882189193*^9, 3.7102928941564283`*^9}, 3.7102929482038393`*^9, {
   3.710293026672846*^9, 3.710293029238657*^9}, {3.710385500937159*^9, 
   3.7103855614852552`*^9}, {3.710385708643643*^9, 3.7103857332914*^9}, {
   3.710385826533915*^9, 3.71038584696319*^9}, {3.71071076873442*^9, 
   3.710710772580805*^9}, 3.710710943910926*^9}],

Cell[BoxData[
 RowBox[{"MapThread", "[", 
  RowBox[{
   RowBox[{
    RowBox[{"{", 
     RowBox[{"#1", ",", "#2"}], "}"}], "&"}], ",", 
   RowBox[{"{", 
    RowBox[{"coloredFlats", ",", 
     RowBox[{"rgbFilters", "[", "imageObj", "]"}]}], "}"}]}], "]"}]], "Input",\

 CellChangeTimes->{{3.7107108196882343`*^9, 3.710710854366413*^9}, {
  3.710710901951379*^9, 3.7107109246484327`*^9}}],

Cell[BoxData[
 RowBox[{"Map", "[", 
  RowBox[{"imageInfo", ",", "coloredFlats"}], "]"}]], "Input",
 CellChangeTimes->{{3.710711348526203*^9, 3.710711375654881*^9}, {
  3.7107114135063057`*^9, 3.710711429328392*^9}}],

Cell[BoxData[
 RowBox[{"(*", " ", 
  RowBox[{
  "Export", " ", "derived", " ", "flats", " ", "back", " ", "to", " ", 
   "source", " ", "directory"}], " ", "*)"}]], "Input",
 CellChangeTimes->{{3.710711241804047*^9, 3.710711274139229*^9}, {
  3.7107113070050383`*^9, 3.710711322095066*^9}}],

Cell[BoxData[
 RowBox[{"MapThread", "[", "\[IndentingNewLine]", 
  RowBox[{
   RowBox[{
    RowBox[{"Export", "[", 
     RowBox[{
      RowBox[{"StringReplace", "[", 
       RowBox[{
        RowBox[{"imageObj", "[", 
         RowBox[{"[", "\"\<fnPathName\>\"", "]"}], "]"}], ",", 
        RowBox[{"\"\</JNCE_\>\"", "\[Rule]", 
         RowBox[{"\"\</Flat_\>\"", "<>", "#2", "<>", "\"\<_\>\""}]}]}], "]"}],
       ",", "#1"}], "]"}], "\[IndentingNewLine]", "&"}], ",", 
   RowBox[{"{", 
    RowBox[{"coloredFlats", ",", 
     RowBox[{"rgbFilters", "[", "imageObj", "]"}]}], "}"}]}], "]"}]], "Input",\

 CellChangeTimes->{{3.7107108196882343`*^9, 3.710710854366413*^9}, {
   3.710710901951379*^9, 3.7107109246484327`*^9}, 3.710710959748529*^9, {
   3.7107110210838213`*^9, 3.710711157128227*^9}, {3.710711200494054*^9, 
   3.710711210780898*^9}, {3.71071155764612*^9, 3.710711573835854*^9}, {
   3.710711665323689*^9, 3.710711752605146*^9}, {3.710711786971385*^9, 
   3.710711806463479*^9}}],

Cell[CellGroupData[{

Cell["Export flatData", "Subsubsection",
 CellChangeTimes->{{3.7107262810754957`*^9, 3.710726285592578*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{
   RowBox[{"StringReplace", "[", 
    RowBox[{
     RowBox[{"imageObj", "[", 
      RowBox[{"[", "\"\<fnPathName\>\"", "]"}], "]"}], ",", 
     RowBox[{"{", 
      RowBox[{
       RowBox[{"\"\</JNCE_\>\"", "\[Rule]", "\"\</Flat_data_\>\""}], ",", 
       RowBox[{"\"\<-raw.png\>\"", "->", "\"\<.wdx\>\""}]}], "}"}]}], "]"}], 
   "\[IndentingNewLine]", ",", "flatData"}], "]"}]], "Input",
 CellChangeTimes->{{3.7107108196882343`*^9, 3.710710854366413*^9}, {
   3.710710901951379*^9, 3.7107109246484327`*^9}, 3.710710959748529*^9, {
   3.7107110210838213`*^9, 3.710711157128227*^9}, {3.710711200494054*^9, 
   3.710711210780898*^9}, {3.71071155764612*^9, 3.710711573835854*^9}, {
   3.710711665323689*^9, 3.710711752605146*^9}, {3.710711786971385*^9, 
   3.710711806463479*^9}, {3.710724993280919*^9, 3.710725105596108*^9}, {
   3.710725166514555*^9, 3.710725207147483*^9}, {3.710725822630282*^9, 
   3.710725823968913*^9}}]
}, Open  ]]
}, Open  ]],

Cell[CellGroupData[{

Cell["Apply flat to segments", "Subsection",
 CellChangeTimes->{{3.7102891420243387`*^9, 3.710289147443829*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "segs", "]"}]], "Input",
 CellChangeTimes->{{3.7103863222285624`*^9, 3.710386381971178*^9}, {
  3.710386416596739*^9, 3.7103864519464893`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "flatImage", "]"}]], "Input",
 CellChangeTimes->{{3.7103864551043863`*^9, 3.710386487146565*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"flattenedSegs", "=", 
    RowBox[{"MapThread", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"(", 
        RowBox[{
         RowBox[{"fic", "=", "#1"}], ";", 
         RowBox[{"Map", "[", 
          RowBox[{
           RowBox[{
            RowBox[{"ImageSubtract", "[", 
             RowBox[{"#", ",", "fic"}], "]"}], "&"}], ",", "#2", ",", 
           RowBox[{"{", 
            RowBox[{"-", "1"}], "}"}]}], "]"}]}], ")"}], "&"}], ",", " ", 
      RowBox[{"{", 
       RowBox[{"flatImage", ",", "segs"}], "}"}]}], "]"}]}], ";"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{"Nested", " ", "Map"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.710289162736052*^9, 3.710289177285788*^9}, {
   3.710289238412869*^9, 3.710289305642221*^9}, {3.7103865029519053`*^9, 
   3.7103865036545753`*^9}, {3.710386592880558*^9, 3.7103866077346354`*^9}, {
   3.710386671856164*^9, 3.710386713120442*^9}, {3.710386754062642*^9, 
   3.7103868247799807`*^9}, {3.710386898487855*^9, 3.710386918621593*^9}, 
   3.710386996254258*^9, {3.710387070159977*^9, 3.710387073416991*^9}, {
   3.7103871811220913`*^9, 3.710387195841116*^9}, 3.710387589680341*^9, {
   3.710387622241005*^9, 3.710387646519175*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "flattenedSegs", "]"}]], "Input",
 CellChangeTimes->{{3.710387672956994*^9, 3.7103876884447947`*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"flattenedSegs", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ImageSubtract", "[", 
        RowBox[{"#", ",", "flatImage"}], "]"}], "&"}], ",", " ", "segs", ",", 
      
      RowBox[{"{", 
       RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710289162736052*^9, 3.710289177285788*^9}, {
   3.710289238412869*^9, 3.710289305642221*^9}, 3.710386308981444*^9}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"flattenedImage", "=", 
   RowBox[{"ImageAdjust", "[", 
    RowBox[{
     RowBox[{"ImageAssemble", "[", "flattenedSegs", "]"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
     RowBox[{"{", 
      RowBox[{"0", ",", 
       RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.7102893180456057`*^9, 3.71028936022635*^9}, {
   3.710294129620996*^9, 3.7102941660695047`*^9}, 3.7102964181246767`*^9, 
   3.71029673055447*^9}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", 
  RowBox[{"flattenedSegs", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1", ",", "1"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7103431740723886`*^9, 3.71034318601791*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Adjust brightness of segments", "Subsection",
 CellChangeTimes->{{3.710303163988368*^9, 3.7103031733932037`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "flattenedSegs", "]"}]], "Input",
 CellChangeTimes->{{3.710296586435843*^9, 3.7102965987677717`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"adjSegs", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"ImageAdjust", "[", 
       RowBox[{"#", ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
        RowBox[{"{", 
         RowBox[{"0", ",", 
          RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}], "&"}], ",", 
     "flattenedSegs", 
     RowBox[{"(*", 
      RowBox[{"[", 
       RowBox[{"[", 
        RowBox[{"All", ",", 
         RowBox[{
          RowBox[{"45", "-", "10"}], ";;", 
          RowBox[{"45", "+", "10"}]}]}], "]"}], "]"}], "*)"}], ",", 
     RowBox[{"{", 
      RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.710297199361437*^9, 3.710297204308182*^9}, {
   3.710297599893037*^9, 3.710297600322754*^9}, {3.710298274632588*^9, 
   3.710298275597436*^9}, 3.710304466529006*^9, {3.7103900795758953`*^9, 
   3.7103900825975237`*^9}, {3.7103901570098248`*^9, 3.710390157112277*^9}, 
   3.710390244778747*^9, {3.71039067715466*^9, 3.710390677576456*^9}, {
   3.710391059075508*^9, 3.710391059225354*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "adjSegs", "]"}]], "Input",
 CellChangeTimes->{{3.710388521022998*^9, 3.710388525640568*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", 
  RowBox[{"Transpose", "[", 
   RowBox[{"adjSegs", ",", 
    RowBox[{"{", 
     RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.7103885544724894`*^9, 3.71038857366644*^9}, {
  3.710388637597743*^9, 3.710388656039563*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"colorSegs", "=", 
   RowBox[{"Transpose", "[", 
    RowBox[{"Map", "[", 
     RowBox[{"ColorCombine", ",", 
      RowBox[{"Transpose", "[", 
       RowBox[{"adjSegs", ",", 
        RowBox[{"{", 
         RowBox[{"3", ",", "2", ",", "1"}], "}"}]}], "]"}], ",", 
      RowBox[{"{", 
       RowBox[{"-", "2"}], "}"}]}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.710388207198559*^9, 3.710388266183752*^9}, {
   3.71038830646459*^9, 3.710388312448193*^9}, {3.710388679194862*^9, 
   3.7103887285094643`*^9}, {3.710388770232051*^9, 3.7103887774865093`*^9}, 
   3.7103888179895372`*^9}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "colorSegs", "]"}]], "Input",
 CellChangeTimes->{{3.7103882722691097`*^9, 3.710388280247691*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"ImageAssemble", "[", "colorSegs", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710388369914558*^9, 3.7103883713363037`*^9}, {
  3.71038883118882*^9, 3.710388844316177*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Create raw viewing color segments", "Subsection",
 CellChangeTimes->{{3.710346600268722*^9, 3.710346610154825*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"adjSegs", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ColorCombine", "[", 
        RowBox[{"{", 
         RowBox[{"#", ",", 
          RowBox[{"iadj", "=", 
           RowBox[{"ImageAdjust", "[", 
            RowBox[{"#", ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", 
               RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}]}], ",", "iadj"}],
          "}"}], "]"}], "&"}], ",", "flattenedSegs", 
      RowBox[{"(*", 
       RowBox[{"[", 
        RowBox[{"[", 
         RowBox[{"All", ",", 
          RowBox[{
           RowBox[{"45", "-", "10"}], ";;", 
           RowBox[{"45", "+", "10"}]}]}], "]"}], "]"}], "*)"}], ",", 
      RowBox[{"{", 
       RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710297199361437*^9, 3.710297204308182*^9}, {
   3.710297599893037*^9, 3.710297600322754*^9}, {3.710298274632588*^9, 
   3.710298275597436*^9}, 3.710304466529006*^9, {3.710346707744505*^9, 
   3.710346779188445*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Annotate segments", "Subsection",
 CellChangeTimes->{{3.710303190194338*^9, 3.710303203451964*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"annotatSegsIn", "=", "colorSegs"}], ";"}]], "Input",
 CellChangeTimes->{{3.710388964320878*^9, 3.7103889777937107`*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "annotatSegsIn", "]"}]], "Input",
 CellChangeTimes->{{3.710298263372747*^9, 3.7102982678091173`*^9}, 
   3.710388982371056*^9}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"padSegs", "=", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{"ImagePad", "[", 
        RowBox[{"#", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}]}], "}"}], ",", "0.0"}], "]"}], 
       "&"}], ",", "adjSegs", ",", 
      RowBox[{"{", 
       RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7102972377406797`*^9, 3.7102973381460733`*^9}, {
  3.710297370879506*^9, 3.7102973786550713`*^9}, {3.710297415255176*^9, 
  3.7102974157727537`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{
   RowBox[{"padSegs", "=", 
    RowBox[{"Map", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"ImagePad", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"ImagePad", "[", 
          RowBox[{"#", ",", 
           RowBox[{"{", 
            RowBox[{
             RowBox[{"{", 
              RowBox[{"0", ",", "64"}], "}"}], ",", 
             RowBox[{"{", 
              RowBox[{"0", ",", "0"}], "}"}]}], "}"}], ",", "0.9"}], "]"}], 
         "\[IndentingNewLine]", ",", 
         RowBox[{"{", 
          RowBox[{
           RowBox[{"{", 
            RowBox[{"0", ",", "0"}], "}"}], ",", 
           RowBox[{"{", 
            RowBox[{"1", ",", "0"}], "}"}]}], "}"}], ",", "0.0"}], "]"}], 
       "\[IndentingNewLine]", "&"}], ",", "annotatSegsIn", ",", 
      RowBox[{"{", 
       RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";"}], " ", 
  RowBox[{"(*", " ", 
   RowBox[{
   "Add", " ", "area", " ", "for", " ", "segment", " ", "number", " ", "and", 
    " ", "thin", " ", "black", " ", "line", " ", "as", " ", "segment", " ", 
    "separator"}], " ", "*)"}]}]], "Input",
 CellChangeTimes->{{3.7102972377406797`*^9, 3.7102973381460733`*^9}, {
   3.710297370879506*^9, 3.7102973786550713`*^9}, {3.710297415255176*^9, 
   3.7102974157727537`*^9}, 3.710299399571121*^9, {3.7102994491408777`*^9, 
   3.7102995979881687`*^9}, {3.7103001529487247`*^9, 3.710300166092395*^9}, 
   3.710389039128255*^9}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "padSegs", "]"}]], "Input",
 CellChangeTimes->{{3.710298185881081*^9, 3.710298199977222*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"ImageAssemble", "[", "padSegs", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7103890551177998`*^9, 3.710389063053589*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{"i", "=", "0"}], ";", 
  RowBox[{"annotatedSegs", "=", 
   RowBox[{"Map", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"(", 
       RowBox[{
        RowBox[{"i", "=", 
         RowBox[{"i", "+", "1"}]}], ";", "\[IndentingNewLine]", 
        RowBox[{"ImageCompose", "[", 
         RowBox[{"#", ",", 
          RowBox[{"cc", "=", 
           RowBox[{"ColorConvert", "[", 
            RowBox[{
             RowBox[{"Rasterize", "[", 
              RowBox[{
               RowBox[{"Graphics", "[", 
                RowBox[{
                 RowBox[{"Rotate", "[", 
                  RowBox[{
                   RowBox[{"Text", "[", 
                    RowBox[{"Style", "[", 
                    RowBox[{"i", ",", "Gray", ",", "40"}], "]"}], "]"}], ",", 
                   
                   RowBox[{"180", "Degree"}]}], "]"}], ",", 
                 RowBox[{"ImageSize", "\[Rule]", 
                  RowBox[{"{", 
                   RowBox[{"64", ",", "64"}], "}"}]}]}], "]"}], ",", 
               RowBox[{"Background", "\[Rule]", "None"}]}], "]"}], ",", 
             "\"\<Grayscale\>\""}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"Right", ",", "Bottom"}], "}"}], ",", 
          RowBox[{"{", 
           RowBox[{"Right", ",", "Bottom"}], "}"}]}], "]"}]}], 
       "\[IndentingNewLine]", ")"}], "&"}], ",", "padSegs", ",", 
     RowBox[{"{", 
      RowBox[{"-", "1"}], "}"}]}], "]"}]}], ";", "i"}], "\[IndentingNewLine]", 
 RowBox[{" ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{
    "Add", " ", "segment", " ", "number", " ", "\"\<i\>\"", " ", "to", " ", 
     "padded", " ", "area", " ", "at", " ", 
     RowBox[{"right", ".", " ", "Text"}], " ", "flipped", " ", "90", 
     "\[Degree]"}], ",", " ", 
    RowBox[{
    "so", " ", "will", " ", "be", " ", "right", " ", "side", " ", "up", " ", 
     "when", " ", "full", " ", "image", " ", "rotated", " ", "to", " ", 
     "have", " ", "Orion", " ", "UP"}]}], " ", "*)"}]}]}], "Input",
 CellChangeTimes->{{3.7103001835285673`*^9, 3.710300213708468*^9}, {
   3.710300244216606*^9, 3.710300250183744*^9}, {3.710300304495946*^9, 
   3.7103003067730083`*^9}, {3.710300402614153*^9, 3.710300416155772*^9}, {
   3.71030048377582*^9, 3.710300589846088*^9}, {3.710301020999436*^9, 
   3.710301048251308*^9}, {3.7103010799221478`*^9, 3.7103010865917892`*^9}, 
   3.710301187181241*^9, {3.710301296139888*^9, 3.7103013068004*^9}, {
   3.710301531606382*^9, 3.710301535483635*^9}, {3.710301628319777*^9, 
   3.710301645028144*^9}, {3.710302191422797*^9, 3.710302243293624*^9}, {
   3.7103023476042147`*^9, 3.710302352795293*^9}, {3.7103025165885267`*^9, 
   3.7103025196463003`*^9}, {3.710302566397361*^9, 3.710302581453844*^9}, 
   3.7103026414711437`*^9, {3.710302712012998*^9, 3.710302716243799*^9}, {
   3.71030302279008*^9, 3.710303026151857*^9}, {3.710303261834141*^9, 
   3.710303394155323*^9}, {3.710303533423657*^9, 3.710303537237192*^9}, {
   3.7103037663327417`*^9, 3.710303812710826*^9}, {3.710304004078526*^9, 
   3.710304006430634*^9}, {3.710304038557179*^9, 3.710304047574082*^9}, {
   3.710304117675111*^9, 3.710304119959116*^9}, {3.7103041878465*^9, 
   3.710304188147794*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "annotatedSegs", "]"}]], "Input",
 CellChangeTimes->{{3.7103892076724987`*^9, 3.710389237289804*^9}}],

Cell[BoxData["cc"], "Input",
 CellChangeTimes->{{3.71030427280951*^9, 3.710304272940144*^9}}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", "cc", "]"}]], "Input",
 CellChangeTimes->{{3.7103042570249023`*^9, 3.710304259727602*^9}}],

Cell[BoxData[
 RowBox[{"annotatedSegs", "[", 
  RowBox[{"[", 
   RowBox[{"1", ",", "1"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710389326274744*^9, 3.7103893264566917`*^9}}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", 
  RowBox[{"annotatedSegs", "[", 
   RowBox[{"[", 
    RowBox[{"1", ",", "1"}], "]"}], "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710301138831101*^9, 3.71030114692395*^9}, {
  3.7103012060937977`*^9, 3.7103012703118973`*^9}, {3.710301323537024*^9, 
  3.7103013251742163`*^9}, {3.710389354592373*^9, 3.710389354702585*^9}}],

Cell[BoxData[
 RowBox[{"Dimensions", "[", "annotatedSegs", "]"}]], "Input",
 CellChangeTimes->{{3.710300740573591*^9, 3.7103007498032084`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"annotatedImage", " ", "=", " ", 
   RowBox[{"ImageAssemble", "[", "annotatedSegs", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.710296443755807*^9, 3.710296623520046*^9}, {
   3.710296762386746*^9, 3.710296834685079*^9}, {3.710296869112722*^9, 
   3.710296869496221*^9}, {3.710297004688819*^9, 3.710297109307939*^9}, {
   3.710297196725439*^9, 3.7102972117694397`*^9}, {3.710297383991873*^9, 
   3.710297385389237*^9}, 3.710300627319057*^9, 3.7103056321354713`*^9}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", "annotatedImage", "]"}]], "Input",
 CellChangeTimes->{{3.71030439399711*^9, 3.710304398848495*^9}}],

Cell[BoxData[
 RowBox[{"(*", "annotatedImage", "*)"}]], "Input",
 CellChangeTimes->{{3.710372291158977*^9, 3.710372292519767*^9}, {
  3.710389651579137*^9, 3.710389656058157*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"croppedAnnotatedImage", "=", 
   RowBox[{"Image", "[", 
    RowBox[{
     RowBox[{"ImageTake", "[", 
      RowBox[{"annotatedImage", ",", 
       RowBox[{
        RowBox[{"{", 
         RowBox[{
          RowBox[{"28", "-", "1"}], ",", "63"}], "}"}], "*", "129"}]}], "]"}],
      ",", "\"\<Bit16\>\""}], "]"}]}], "*)"}]], "Input",
 CellChangeTimes->{{3.710304828403063*^9, 3.710304897814083*^9}, {
  3.710304943003796*^9, 3.710304947921356*^9}, {3.7103049859693336`*^9, 
  3.710305018443553*^9}, {3.7103050925105867`*^9, 3.7103050950938063`*^9}, {
  3.710347040190152*^9, 3.7103470838137903`*^9}, {3.7103472417403097`*^9, 
  3.710347245063088*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"croppedAnnotatedImage", "=", 
   RowBox[{"Image", "[", 
    RowBox[{
     RowBox[{"ImageTake", "[", 
      RowBox[{"annotatedImage", ",", 
       RowBox[{"{", 
        RowBox[{"1", ",", 
         RowBox[{"-", "1"}]}], "}"}]}], "]"}], ",", "\"\<Bit16\>\""}], 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.710304828403063*^9, 3.710304897814083*^9}, {
   3.710304943003796*^9, 3.710304947921356*^9}, {3.7103049859693336`*^9, 
   3.710305018443553*^9}, {3.7103050925105867`*^9, 3.7103050950938063`*^9}, {
   3.710347040190152*^9, 3.7103470838137903`*^9}, {3.7103472417403097`*^9, 
   3.710347245063088*^9}, 3.710389559187859*^9, {3.710389632102799*^9, 
   3.710389634284336*^9}, 3.710390658051462*^9}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"ImageAssemble", "[", 
   RowBox[{"{", 
    RowBox[{
     RowBox[{"ImageAdjust", "[", 
      RowBox[{"flattenedImage", ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}], ",", 
     RowBox[{"ImageAdjust", "[", 
      RowBox[{
       RowBox[{"ImageAssemble", "[", "segs", "]"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"0", ",", 
         RowBox[{"8", "/", "2879."}]}], "}"}]}], "]"}]}], "}"}], "]"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.710289369392253*^9, 3.7102894110171328`*^9}, {
  3.71029033349608*^9, 3.710290439832858*^9}}],

Cell[BoxData[
 RowBox[{"ColorSeparate", "[", "croppedAnnotatedImage", "]"}]], "Input",
 CellChangeTimes->{{3.7103903593450947`*^9, 3.7103903723801937`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Export", "Subsection",
 CellChangeTimes->{{3.70870564259851*^9, 3.7087056433567343`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"finalCrop", "=", "croppedAnnotatedImage"}], ";"}]], "Input",
 CellChangeTimes->{{3.7087057625371*^9, 3.7087057743587*^9}, {
   3.708707365490856*^9, 3.7087073690409107`*^9}, {3.7095070436141977`*^9, 
   3.709507046589714*^9}, {3.7099062897351093`*^9, 3.7099062906158457`*^9}, 
   3.70994309795159*^9, 3.710293940385795*^9, 3.710305203335874*^9}],

Cell[BoxData[
 RowBox[{"imageInfo", "[", "finalCrop", "]"}]], "Input",
 CellChangeTimes->{{3.710293967214466*^9, 3.710293972903351*^9}}],

Cell[BoxData[
 RowBox[{"Export", "[", 
  RowBox[{"\"\</tmp/juno15.png\>\"", ",", "finalCrop"}], "]"}]], "Input",
 CellChangeTimes->{{3.708644236719198*^9, 3.708644292186872*^9}, {
   3.708707386664171*^9, 3.708707390453937*^9}, {3.709468056146146*^9, 
   3.7094680853030787`*^9}, {3.70950706240515*^9, 3.7095070624506483`*^9}, {
   3.70990629495047*^9, 3.709906295003878*^9}, {3.710293843696712*^9, 
   3.7102938437583427`*^9}, 3.710346890499753*^9, {3.710389685234631*^9, 
   3.710389686016466*^9}}],

Cell[BoxData[
 RowBox[{"imageObj", "[", 
  RowBox[{"[", "\"\<fnPathName\>\"", "]"}], "]"}]], "Input",
 CellChangeTimes->{{3.710163897321097*^9, 3.7101639175999403`*^9}, {
  3.7101639689107237`*^9, 3.710163976228409*^9}, {3.710210743375836*^9, 
  3.710210747520919*^9}}],

Cell[BoxData[
 RowBox[{"ImageDimensions", "[", "finalCrop", "]"}]], "Input",
 CellChangeTimes->{{3.709512528655818*^9, 3.7095125439027967`*^9}}]
}, Open  ]],

Cell[CellGroupData[{

Cell["Compare image created with Real32 and Real64", "Subsection",
 CellChangeTimes->{{3.710343551311576*^9, 3.710343590404373*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"img32", "=", 
    RowBox[{"Import", "[", "\"\</tmp/juno14.png\>\"", "]"}]}], ";"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.710343616267927*^9, 3.710343644979225*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"imageInfo", "[", "img32", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710343653906081*^9, 3.710343659714937*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"img64", "=", 
    RowBox[{
    "Import", "[", 
     "\"\</Users/bswift/Pictures/Jupiter/Junocam/601-v14.png\>\"", "]"}]}], 
   ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710343663451949*^9, 3.7103436709075527`*^9}, {
  3.710343716881157*^9, 3.710343722813587*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"imageInfo", "[", "img64", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.710343725678651*^9, 3.710343736765409*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{
   RowBox[{"diffImg", "=", 
    RowBox[{"ImageDifference", "[", 
     RowBox[{"img32", ",", "img64"}], "]"}]}], ";"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7103437596757507`*^9, 3.710343798015707*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"imageInfo", "[", "diffImg", "]"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7103438008739758`*^9, 3.710343808536676*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Total", "[", 
   RowBox[{"Flatten", "[", 
    RowBox[{"ImageData", "[", 
     RowBox[{"Binarize", "[", 
      RowBox[{"diffImg", ",", 
       RowBox[{"1", "/", 
        RowBox[{"2", "^", "30"}]}]}], "]"}], "]"}], "]"}], "]"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.710344419484181*^9, 3.710344434064824*^9}, {
  3.710344479661224*^9, 3.7103445012686033`*^9}, {3.710344590814795*^9, 
  3.710344596187971*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"Total", "[", 
   RowBox[{"65535", " ", 
    RowBox[{"Flatten", "[", 
     RowBox[{"ImageData", "[", "diffImg", "]"}], "]"}]}], "]"}], 
  "*)"}]], "Input",
 CellChangeTimes->{{3.710344419484181*^9, 3.710344434064824*^9}, {
  3.710344479661224*^9, 3.7103445012686033`*^9}, {3.710344590814795*^9, 
  3.710344610629037*^9}, {3.710344672802225*^9, 3.710344678056286*^9}, {
  3.710344732781599*^9, 3.710344740556126*^9}}],

Cell[BoxData[
 RowBox[{"(*", 
  RowBox[{"ImageAdjust", "[", 
   RowBox[{"diffImg", ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", "0", ",", "1"}], "}"}], ",", 
    RowBox[{"{", 
     RowBox[{"0", ",", 
      RowBox[{"1", "/", 
       RowBox[{"2", "^", "30"}]}]}], "}"}]}], "]"}], "  ", 
  RowBox[{"(*", " ", 
   RowBox[{
    RowBox[{"611", " ", "one"}], "-", 
    RowBox[{"bit", " ", "differences"}]}], " ", "*)"}], "*)"}]], "Input",
 CellChangeTimes->{{3.7103438335564623`*^9, 3.710343834710156*^9}, {
  3.710344202652014*^9, 3.710344207491589*^9}, {3.710344250589573*^9, 
  3.710344330932123*^9}, {3.7103443898349333`*^9, 3.710344400978344*^9}, {
  3.710344513731328*^9, 3.710344513977597*^9}, {3.710344823325458*^9, 
  3.71034482662759*^9}}]
}, Open  ]]
}, Open  ]]
},
WindowSize->{1171, 845},
WindowMargins->{{19, Automatic}, {Automatic, 0}},
FrontEndVersion->"11.0 for Mac OS X x86 (32-bit, 64-bit Kernel) (September \
21, 2016)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[CellGroupData[{
Cell[580, 22, 763, 10, 92, "Title"],
Cell[CellGroupData[{
Cell[1368, 36, 97, 1, 44, "Subsection"],
Cell[1468, 39, 73, 1, 32, "Input"],
Cell[1544, 42, 60, 1, 32, "Input"],
Cell[1607, 45, 628, 14, 75, "Input"],
Cell[2238, 61, 442, 10, 32, "Input"],
Cell[2683, 73, 3739, 55, 285, "Input"],
Cell[6425, 130, 761, 20, 54, "Input"],
Cell[7189, 152, 509, 13, 32, "Input"],
Cell[7701, 167, 434, 8, 29, "Text"],
Cell[8138, 177, 635, 13, 32, "Input"],
Cell[8776, 192, 2480, 49, 222, "Input"],
Cell[11259, 243, 661, 15, 75, "Input"],
Cell[CellGroupData[{
Cell[11945, 262, 132, 1, 35, "Subsubsection"],
Cell[12080, 265, 629, 17, 239, "Text"],
Cell[12712, 284, 3876, 70, 390, "Input"],
Cell[16591, 356, 4367, 88, 432, "Input"],
Cell[20961, 446, 351, 9, 32, "Input"],
Cell[21315, 457, 805, 17, 54, "Input"],
Cell[22123, 476, 233, 5, 30, "Text"],
Cell[22359, 483, 3246, 63, 369, "Input"],
Cell[25608, 548, 1214, 26, 54, "Input"],
Cell[26825, 576, 1345, 26, 54, "Input"],
Cell[28173, 604, 1266, 27, 75, "Input"],
Cell[29442, 633, 520, 12, 32, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[30011, 651, 156, 2, 44, "Subsection"],
Cell[30170, 655, 153, 3, 32, "Input"],
Cell[30326, 660, 132, 2, 32, "Input"],
Cell[30461, 664, 220, 4, 32, "Input"],
Cell[30684, 670, 269, 5, 32, "Input"],
Cell[30956, 677, 168, 3, 32, "Input"],
Cell[31127, 682, 140, 2, 32, "Input"],
Cell[31270, 686, 201, 4, 32, "Input"],
Cell[31474, 692, 290, 7, 32, "Input"],
Cell[31767, 701, 192, 4, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[31996, 710, 112, 1, 44, "Subsection"],
Cell[CellGroupData[{
Cell[32133, 715, 95, 1, 35, "Subsubsection"],
Cell[32231, 718, 225, 5, 32, "Input"],
Cell[32459, 725, 177, 3, 32, "Input"],
Cell[32639, 730, 134, 2, 32, "Input"],
Cell[32776, 734, 220, 5, 32, "Input"],
Cell[32999, 741, 813, 19, 32, "Input"],
Cell[33815, 762, 175, 3, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[34027, 770, 238, 6, 35, "Subsubsection"],
Cell[34268, 778, 319, 6, 30, "Text"],
Cell[34590, 786, 1384, 33, 117, "Input"],
Cell[35977, 821, 1599, 34, 138, "Input"],
Cell[37579, 857, 191, 3, 32, "Input"],
Cell[37773, 862, 2439, 46, 75, "Input"],
Cell[40215, 910, 238, 6, 32, "Input"],
Cell[40456, 918, 558, 13, 32, "Input"],
Cell[41017, 933, 1171, 27, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[42225, 965, 164, 3, 35, "Subsubsection"],
Cell[42392, 970, 1386, 32, 117, "Input"],
Cell[43781, 1004, 247, 6, 32, "Input"],
Cell[44031, 1012, 171, 3, 32, "Input"],
Cell[44205, 1017, 2245, 40, 54, "Input"],
Cell[46453, 1059, 2455, 46, 96, "Input"],
Cell[48911, 1107, 467, 10, 32, "Input"],
Cell[49381, 1119, 118, 1, 30, "Text"],
Cell[49502, 1122, 339, 8, 32, "Input"],
Cell[49844, 1132, 134, 2, 32, "Input"],
Cell[49981, 1136, 926, 25, 32, "Input"]
}, Closed]],
Cell[CellGroupData[{
Cell[50944, 1166, 163, 3, 29, "Subsubsection"],
Cell[51110, 1171, 412, 10, 32, "Input"],
Cell[51525, 1183, 138, 2, 32, "Input"],
Cell[51666, 1187, 324, 6, 32, "Input"],
Cell[51993, 1195, 326, 7, 34, "Input"],
Cell[52322, 1204, 455, 8, 32, "Input"],
Cell[52780, 1214, 475, 10, 32, "Input"],
Cell[53258, 1226, 561, 12, 32, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[53868, 1244, 101, 1, 44, "Subsection"],
Cell[53972, 1247, 240, 4, 30, "Text"],
Cell[54215, 1253, 132, 2, 32, "Input"],
Cell[54350, 1257, 150, 2, 32, "Input"],
Cell[54503, 1261, 373, 9, 32, "Input"],
Cell[54879, 1272, 792, 18, 32, "Input"],
Cell[55674, 1292, 136, 2, 32, "Input"],
Cell[55813, 1296, 275, 7, 32, "Input"],
Cell[56091, 1305, 142, 2, 32, "Input"],
Cell[56236, 1309, 455, 11, 32, "Input"],
Cell[56694, 1322, 521, 11, 32, "Input"],
Cell[57218, 1335, 893, 24, 96, "Input"],
Cell[58114, 1361, 136, 2, 32, "Input"],
Cell[58253, 1365, 436, 10, 32, "Input"],
Cell[58692, 1377, 459, 11, 32, "Input"],
Cell[59154, 1390, 195, 3, 32, "Input"],
Cell[59352, 1395, 778, 18, 32, "Input"],
Cell[60133, 1415, 319, 8, 32, "Input"],
Cell[60455, 1425, 195, 4, 32, "Input"],
Cell[60653, 1431, 498, 12, 32, "Input"],
Cell[61154, 1445, 1093, 22, 126, "Text"],
Cell[62250, 1469, 153, 2, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[62440, 1476, 107, 1, 44, "Subsection"],
Cell[62550, 1479, 132, 1, 30, "Text"],
Cell[62685, 1482, 818, 18, 32, "Input"],
Cell[63506, 1502, 385, 11, 32, "Input"],
Cell[63894, 1515, 215, 4, 32, "Input"],
Cell[64112, 1521, 290, 6, 32, "Input"],
Cell[64405, 1529, 989, 22, 75, "Input"],
Cell[CellGroupData[{
Cell[65419, 1555, 108, 1, 35, "Subsubsection"],
Cell[65530, 1558, 972, 19, 54, "Input"]
}, Open  ]]
}, Open  ]],
Cell[CellGroupData[{
Cell[66551, 1583, 112, 1, 44, "Subsection"],
Cell[66666, 1586, 185, 3, 32, "Input"],
Cell[66854, 1591, 139, 2, 32, "Input"],
Cell[66996, 1595, 1231, 28, 32, "Input"],
Cell[68230, 1625, 143, 2, 32, "Input"],
Cell[68376, 1629, 480, 13, 32, "Input"],
Cell[68859, 1644, 532, 13, 32, "Input"],
Cell[69394, 1659, 228, 5, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[69659, 1669, 119, 1, 44, "Subsection"],
Cell[69781, 1672, 143, 2, 32, "Input"],
Cell[69927, 1676, 1096, 28, 32, "Input"],
Cell[71026, 1706, 135, 2, 32, "Input"],
Cell[71164, 1710, 306, 7, 32, "Input"],
Cell[71473, 1719, 627, 15, 32, "Input"],
Cell[72103, 1736, 139, 2, 32, "Input"],
Cell[72245, 1740, 215, 4, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[72497, 1749, 121, 1, 44, "Subsection"],
Cell[72621, 1752, 1150, 31, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[73808, 1788, 105, 1, 44, "Subsection"],
Cell[73916, 1791, 155, 3, 32, "Input"],
Cell[74074, 1796, 169, 3, 32, "Input"],
Cell[74246, 1801, 697, 20, 32, "Input"],
Cell[74946, 1823, 1462, 36, 117, "Input"],
Cell[76411, 1861, 135, 2, 32, "Input"],
Cell[76549, 1865, 165, 3, 32, "Input"],
Cell[76717, 1870, 3194, 67, 159, "Input"],
Cell[79914, 1939, 143, 2, 32, "Input"],
Cell[80060, 1943, 93, 1, 32, "Input"],
Cell[80156, 1946, 131, 2, 32, "Input"],
Cell[80290, 1950, 181, 4, 32, "Input"],
Cell[80474, 1956, 366, 7, 32, "Input"],
Cell[80843, 1965, 143, 2, 32, "Input"],
Cell[80989, 1969, 503, 8, 32, "Input"],
Cell[81495, 1979, 140, 2, 32, "Input"],
Cell[81638, 1983, 179, 3, 32, "Input"],
Cell[81820, 1988, 689, 16, 32, "Input"],
Cell[82512, 2006, 739, 16, 32, "Input"],
Cell[83254, 2024, 792, 22, 32, "Input"],
Cell[84049, 2048, 156, 2, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[84242, 2055, 95, 1, 44, "Subsection"],
Cell[84340, 2058, 380, 6, 32, "Input"],
Cell[84723, 2066, 136, 2, 32, "Input"],
Cell[84862, 2070, 500, 8, 32, "Input"],
Cell[85365, 2080, 269, 5, 32, "Input"],
Cell[85637, 2087, 144, 2, 32, "Input"]
}, Open  ]],
Cell[CellGroupData[{
Cell[85818, 2094, 132, 1, 44, "Subsection"],
Cell[85953, 2097, 223, 6, 32, "Input"],
Cell[86179, 2105, 157, 3, 32, "Input"],
Cell[86339, 2110, 321, 9, 32, "Input"],
Cell[86663, 2121, 157, 3, 32, "Input"],
Cell[86823, 2126, 245, 6, 32, "Input"],
Cell[87071, 2134, 161, 3, 32, "Input"],
Cell[87235, 2139, 454, 12, 32, "Input"],
Cell[87692, 2153, 456, 10, 32, "Input"],
Cell[88151, 2165, 744, 18, 32, "Input"]
}, Open  ]]
}, Open  ]]
}
]
*)

